<html t:type="ui/internal/pagestructure"
	bodyId="literal:MailingListEntry" bodyClass="literal:internal-page"
	xmlns:t="http://tapestry.apache.org/schema/tapestry_5_1_0.xsd"
	xmlns:p="tapestry:parameter">

<div id="addstudent-block" class="show">

    <t:if test="hasMailingLists()">
        <t:delegate to="block:editor"/>
        <p:else>
            <h3>Sorry, there are no mailing lists available for online
                subscription now.</h3>
            <script type="text/javascript">
                setTimeout("window.location.href='${redirectLink}'", 10000);
            </script>
        </p:else>
    </t:if>
</div>

<t:block t:id="editor">
    <t:delegate to="block:errors"/>
    <t:if test="controller">
		<t:remove>
			parameter secure=true is used to be sure that the form action action will be secure.
			parameter clientValidation=NONE is used to exclude injection tapestry java script handling for this form
		</t:remove>
        <t:form t:id="mailingListForm" clientValidation="literal:NONE" secure="true">
            <t:if test="controller.addContact">
                <t:delegate to="block:mailingLists"/>
                <t:delegate to="block:addContact"/>
                <t:delegate to="block:notes"/>
                <t:delegate to="block:control"/>
            </t:if>
            <t:if test="controller.editContact">
                <t:delegate to="block:mailingLists"/>
                <t:delegate to="block:editContact"/>
                <t:delegate to="block:notes"/>
                <t:delegate to="block:control"/>
            </t:if>
        </t:form>
        <t:if test="controller.finished">
            <t:delegate to="block:result"/>
        </t:if>
    </t:if>
</t:block>

<t:block t:id="control">
    <div class="form-controls">
        <t:submit t:id="addMailingList" value="Subscribe" class="btn btn-primary"/>
    </div>
</t:block>

<t:block t:id="notes">
    <p class="note">
        <strong class="alert">Note</strong>: ${message:message-noteSameEmail}
    </p>
</t:block>

<t:block t:id="result">
    <h3>You have been successfully subscribed to the following
        mailing lists:</h3>

    <ul>
        <t:loop t:source="selectedMailingLists" value="currentMailingList">
            <li><strong>${currentMailingList.name}</strong></li>
        </t:loop>
    </ul>
    <script type="text/javascript">
        setTimeout("window.location.href='${redirectLink}'", 10000);
    </script>
</t:block>

<t:block t:id="mailingLists">
    <t:mailinglistbox controller="controller"/>
</t:block>

<t:block t:id="errors">
    <t:if test="expired">
        <div class="error">
            <p>${message:message-sessionExpired}</p>
            <script type="text/javascript">
                setTimeout("window.location.href='${redirectLink}'", 10000);
            </script>
        </div>
        <p:else>
           <span t:type="checkout/errors" errors="controller.errors" warnings="controller.warnings"/>
        </p:else>
    </t:if>
</t:block>


<t:block t:id="addContact">
    <div class="message">
        <p>To continue, please enter the details of a person to subscribe.</p>
    </div>
    <fieldset>
        <span t:type="checkout/contact/addcontactfieldset" delegate="controller" validateHandler="validateHandler"/>
    </fieldset>
</t:block>

<t:block t:id="editContact">
    <div class="student">${controller.contact.fullName} <span>- ${controller.contact.emailAddress}</span></div>
    <p>Thank you ${controller.contact.fullName} for your request. Please fill additional information about you:</p>
    <fieldset>
        <span t:type="checkout/contact/contacteditorfieldset" delegate="controller" validateHandler="validateHandler"/>
    </fieldset>
</t:block>


<link rel="stylesheet" type="text/css" href="${request.contextPath}/css/enrol.css"/>
<script type="text/javascript" src="${request.contextPath}/js/enrol-min.js"></script>
</html>
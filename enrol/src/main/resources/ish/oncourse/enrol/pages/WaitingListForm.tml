<html t:type="ui/internal/pagestructure" bodyId="literal:EnrolmentEntry"
	  bodyClass="literal:internal-page"
	  xmlns:t="http://tapestry.apache.org/schema/tapestry_5_1_0.xsd"
	  xmlns:p="tapestry:parameter">

	<div id="waitingListBlock">
		<t:delegate to="block:waitingListBlock"/>
	</div>

	<t:block t:id="waitingListBlock">
		<t:delegate to="block:exceptionHandling"/>
		<t:if test="controller">
			<t:if test="controller.finished">
				<t:delegate to="block:finished"/>
				<p:else>
					<t:delegate to="block:editor"/>
				</p:else>
			</t:if>
		</t:if>
	</t:block>



	<t:block t:id="addContact">
		<p>To join the waiting list for course ${controller.course.name}, please complete the following form:</p>
		<fieldset>
			<span t:type="checkout/contact/addcontactfieldset" delegate="controller" validateHandler="validateHandler"/>
		</fieldset>
	</t:block>

	<t:block t:id="editContact">
		<p>Thank you ${controller.contact.fullName} for your request. Please fill additional information about you:</p>
		<fieldset>
			<span t:type="checkout/contact/contacteditorfieldset" delegate="controller" validateHandler="validateHandler"/>
		</fieldset>
	</t:block>

	<t:block t:id="editDescription">
		<fieldset>
			<p>
				<label for="detail">
					What you'd like:
										<span class="description">
											Please tell us your preferences, eg on Tuesdays, in Newtown, etc.
										</span>
				</label>
				<t:textarea t:id="detail" t:value="controller.waitingList.detail"
							cols="30" rows="4" />
			</p>
			<p>
				<label for="potentialStudents">Number of students (including you)<em title="${message:required}">*</em></label>
				<span class="${validateHandler.validateClass('potentialStudents')}">
					<t:textfield t:id="potentialStudents"
							 t:value="controller.waitingList.potentialStudents" class="input-fixed ${validateHandler.errorClass('potentialStudents')}"/>
					<span t:type="ui/HintComponent" validationMessage="${validateHandler.error('potentialStudents')}"/>
				</span>
			</p>
		</fieldset>
	</t:block>

	<t:block t:id="finished">
		<div class="message">
			<p class="feedback">
				Thank you for your request.
				<br/>
				The student <b>${controller.contact.fullName}</b> (<b>${controller.waitingList.potentialStudents}</b> potential places)
				<br/>
				was successfully added to waiting list for course <b>${controller.course.name}${resetController()}</b>.
			</p>
		</div>
	</t:block>

	<t:block t:id="editor">
		<t:form t:id="waitingListForm">
			<t:if test="controller.errors.isEmpty()" negate="true">
				<t:delegate to="block:errors"/>
			</t:if>
			<t:if test="controller.addContact">
				<t:delegate to="block:addContact"/>
			</t:if>
			<t:if test="controller.editContact">
				<t:delegate to="block:editContact"/>
			</t:if>
			<t:delegate to="block:editDescription"/>
		</t:form>
		<button id="addWaitingList">Add to waiting list</button>
		<t:eventlink t:id="addWaitingListEvent" style="display: none"/>
	</t:block>


	<t:block t:id="errors">
		<div class="validation">
			<div>${message:error-commonHeader}</div>
			<ul>
				<t:loop source="controller.errors.values()" value="error">
					<li>${error}</li>
				</t:loop>
			</ul>
		</div>
	</t:block>

	<t:block t:id="exceptionHandling">
		<t:if test="unknownCourse">
			Sorry, the course is not defined.
		</t:if>
		<t:if test="expired">
			<div class="error">
				<p>${message:error-sessionExpired}</p>
			</div>
		</t:if>
		<t:if test="unexpectedThrowable">
			<script type="text/javascript">
				setTimeout("window.location.href='/enrol/waitinglistform'", 100);
			</script>
		</t:if>
	</t:block>



	<script type="text/javascript" src="${asset:context:js/jquery.blockUI.js}"/>
<script type="text/javascript" src="${asset:context:js/_waitinglist.js}"/>
</html>
<html t:type="ui/internal/pagestructure" eventName="${eventName}" cart="${cart}" bodyId="literal:PaymentPage"
      bodyClass="literal:internal-page"
      xmlns:t="http://tapestry.apache.org/schema/tapestry_5_1_0.xsd">

<t:if test="paymentProgress">
    <meta http-equiv="refresh" content="3"/>
</t:if>
<div id="checkout" class="payments">
    <t:delegate to="block:payment"/>
</div>


<t:block t:id="payment">
	<t:delegate to="block:progress"/>
    <t:delegate to="block:errors"/>
    <t:if test="purchaseController">
        <t:if test="editPayments">
            <t:delegate to="block:amount"/>
            <t:delegate to="block:paymentEditors"/>
        </t:if>
        <t:if test="purchaseController.addContact">
            <span t:type="checkout/contact/addcontact" delegate="purchaseController.addContactDelegate"
                  returnPage="this" showCancelLink="true"/>
        </t:if>
        <t:if test="purchaseController.editContact">
            <span t:type="checkout/contact/contacteditor" delegate="purchaseController.contactEditorDelegate"
                  returnPage="this" returnBlock="paymentBlock" showCancelLink="true"/>
        </t:if>
        <t:if test="paymentResult">
            <t:delegate to="block:paymentResult"/>
        </t:if>
        <t:if test="paymentProgress">
            <t:delegate to="block:paymentProgress"/>
        </t:if>
    </t:if>
</t:block>

<t:block t:id="paymentEditors">
	<t:remove>
		parameter secure=true is used to be sure that the form action action will be secure.
		parameter clientValidation=NONE is used to exclude injection tapestry java script handling for this form
	</t:remove>
	<t:form t:id="paymentform" clientValidation="literal:NONE" secure="true">
        <div id="tabable-container">
            <ul class="nav">
				<t:if test="purchaseController.creditCardPaymentEnabled">
					<li class="first ${cardTabClass}">
						<a href="#credit-card">Credit card</a>
					</li>
				</t:if>
                <t:if test="containsProduct" negate="true">
				    <t:if test="purchaseController.corporatePassPaymentEnabled">
					    <li class="${corporatePassTabClass}">
					    	<a href="#corporate-pass">CorporatePass</a>
					    </li>
				    </t:if>
                </t:if>
            </ul>
            <div class="tab-content">
				<t:if test="purchaseController.creditCardPaymentEnabled">
					<div class="single-tab ${cardTabClass}" id="credit-card">
						<t:delegate to="block:paymentEditor"/>
					</div>
				</t:if>
				<t:if test="purchaseController.corporatePassPaymentEnabled">
					<div class="single-tab ${corporatePassTabClass}" id="corporate-pass">
						<t:delegate to="block:corporatePassEditor"/>
					</div>
				</t:if>
            </div>
        </div>
        <span t:type="checkout/payment/paymentcontrol" delegate="purchaseController.paymentEditorDelegate"/>
    </t:form>
</t:block>

<t:block t:id="progress">
    <span t:type="checkout/progress" purchaseController="purchaseController"/>
</t:block>

<t:block t:id="amount">
    <div class="amount-container">
        <span t:type="checkout/addcode" purchaseController="purchaseController" blockToRefresh="paymentBlock"/>
        <span t:type="checkout/amount" purchaseController="purchaseController" blockToRefresh="paymentBlock"
              showPayerFields="showPayerFields"/>
        <!-- the code need to clear the floats.-->
        <div class="clearboth"></div>
    </div>
</t:block>

<t:block t:id="paymentEditor">
    <span t:type="checkout/payment/paymenteditor" delegate="purchaseController.paymentEditorDelegate"
          blockToRefresh="paymentBlock"/>
</t:block>

<t:block t:id="corporatePassEditor">
    <span t:type="checkout/payment/corporatePassEditor" delegate="purchaseController.paymentEditorDelegate" blockToRefresh="paymentBlock"/>
</t:block>

<t:block t:id="paymentProgress">
    <span t:type="checkout/payment/paymentProgress" delegate="purchaseController.paymentEditorDelegate"/>
</t:block>

<t:block t:id="paymentResult">
    <span t:type="checkout/payment/paymentresult" delegate="purchaseController.paymentEditorDelegate"/>
</t:block>

<t:block t:id="errors">
    <t:if test="expired">
		  <span t:type="checkout/payment/expiredsession"/>
    </t:if>

    <t:if test="purchaseController">
        <span t:type="checkout/errors" errors="purchaseController.errors" warnings="purchaseController.warnings"/>
    </t:if>
</t:block>


<link href="/s/enrol/css/checkout.css" media="screen, print" rel="stylesheet" />
<script type="text/javascript" src="/s/enrol/js/jquery.blockUI.js"></script>
<script type="text/javascript" src="/s/enrol/js/common.js"></script>
<script type="text/javascript" src="/s/enrol/js/checkout.js"></script>


</html>
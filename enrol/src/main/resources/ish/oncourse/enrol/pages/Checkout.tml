<html t:type="ui/internal/pagestructure" bodyId="literal:EnrolmentEntry"
	bodyClass="literal:internal-page"
	xmlns:t="http://tapestry.apache.org/schema/tapestry_5_1_0.xsd"
	xmlns:p="tapestry:parameter">
	<script t:type="ui/jsassetgroup" group="literal:core-enrol" />
	
	<t:if test="paymentGatewayEnabled">
		<t:if test="needInitPayer">
			<script type="text/javascript">
				setTimeout("window.location.href='${addPayerURL}'", 100);
			</script>
		<p:else>
			<t:if test="controller">
				<t:if test="somethingToCheckout">
					<script type="text/javascript">
						var enrolmentEntryDisplayed = true;
					</script>
					<t:zone t:id="payersZone" t:update="show">
						<!-- start enrolments summary -->
						<table class="payments">
							<colgroup>
								<col />
								<col width="80" />
								<col width="80" />
							</colgroup>
							<t:loop source="controller.model.contacts" value="contact" index="studentIndex">
								<thead>
									<tr>
										<th colspan="3">
											<div class="left">${contact.fullName} <span>-
												${contact.emailAddress}</span>
											</div>
											<t:if test="payer">
												<span class="payer" style="padding-right:5px;">Payer</span>
												<t:form t:id="payerForm" zone="payersZone">
													<span class="valid">
													<t:select t:id="currentPayer" value="currentPayerContact" model="payersModel" 
														encoder="payersEncoder" 
														blankOption="NEVER" zone="payersZone"/>
													</span>
												</t:form>
											</t:if>
											<div class="right">
											<t:if test="showConcessionsArea">
												<a id="add-concession_${studentIndex}" class="add-concession">
												<span>Add Concession</span> </a>
											</t:if>
											</div>
										</th>
									</tr>
								<t:if test="showConcessionsArea">
									<tr colspan="3">
										<th colspan="3"><span t:type="CheckoutConcessionEntry"
											index="studentIndex" /></th>
									</tr>
								</t:if>
							</thead>
							<tbody>
								<span t:type="CheckoutContactEnrolmentList" classes="controller.classesToEnrol" studentIndex="studentIndex"/>
							</tbody>
						</t:loop>

						<t:zone t:id="totals" class="t-update" elementName="tbody">
							<t:if test="controller.hasDiscount">
								<tr>
									<td colspan="2" class="alignright">Discount</td>
									<td class="alignright" id="discounttotal"><t:output
										value="controller.totalDiscountAmountIncTax" format="controller.moneyFormat" /></td>
								</tr>
							</t:if>
							<tr>
								<td><span id="addstudent">Add another student</span></td>
								<td class="alignright">Total</td>
								<td class="alignright" id="total"><t:output
									value="controller.totalIncGst" format="controller.moneyFormat" /></td>
							</tr>
						</t:zone>
					</table>
						
					</t:zone>
				<p:else>
					<h3>Add a classes or products</h3>
					<div class="error">
					<p>You do not have any classes or products in your order as yet. Please <a
						href="${coursesListLink}">select a class</a> from the courses
					available.</p>
					</div>
				</p:else>	
				</t:if>
			</t:if>
			<span t:type="EnrolmentContactEntry" nextPageName="nextPage"/>
			<script type="text/javascript">
			Event.observe('totals', Tapestry.ZONE_UPDATED_EVENT, function(){
				initAddStudentButton();
			});
		</script>
		</p:else>
    	</t:if>
	<p:else>
		Payment gateway processing is disabled for this college.
	</p:else>
	</t:if>
	<t:actionLink t:id="checkSession"/>
</html>
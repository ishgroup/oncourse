<html t:type="ui/internal/pagestructure" bodyId="literal:CheckoutPage"
	  bodyClass="literal:internal-page"
	  xmlns:t="http://tapestry.apache.org/schema/tapestry_5_1_0.xsd">

<div id="checkout">
	<t:delegate to="block:checkout"/>
</div>


<t:block t:id="checkout">
	<t:if test="purchaseController">
		<t:delegate to="block:errors"/>
		<t:if test="purchaseController.editCheckout">
			<t:delegate to="block:payments"/>
		</t:if>
		<t:if test="purchaseController.editConcession">
			<t:delegate to="block:concessionEditor"/>
		</t:if>
		<t:if test="purchaseController.addContact">
			<t:delegate to="block:addContact"/>
		</t:if>
		<t:if test="purchaseController.editContact">
			<t:delegate to="block:contactEditor"/>
		</t:if>
	</t:if>
</t:block>

<t:block t:id="errors">
	<span t:type="checkout/errors" errors="purchaseController.errors" warnings="purchaseController.warnings"/>
</t:block>

<t:block t:id="payments">
	<table class="payments">
		<span t:type="checkout/contactlist" purchaseController="purchaseController" blockToRefresh="checkoutBlock"/>
		<tbody class="t-update t-zone" id="totals">
		<tr>
			<td>
				<div id="addContact">Add another student</div>
				<t:eventlink t:id="addContactEvent" style="{display:none}"/>
			</td>
			<td class="alignright">Total</td>
			<td id="total" class="alignright">
				<span class="totalPrice">
					<t:output value="purchaseController.totalIncGst" format="moneyFormat(purchaseController.totalIncGst)"/>
				</span>
			</td>
		</tr>
		</tbody>
	</table>

	<div class="amount-container">
		<span t:type="checkout/addcode" purchaseController="purchaseController"/>
		<span t:type="checkout/amount" purchaseController="purchaseController"/>
		<t:eventlink t:id="proceedToPaymentEvent" class="btn btn-primary">Proceed to Payment</t:eventlink>
	</div>
</t:block>

<t:block t:id="concessionEditor">
	<span t:type="checkout/concession/concessionEditor" delegate="purchaseController.concessionDelegate"/>
</t:block>

<t:block t:id="addContact">
	<span t:type="checkout/contact/addcontact" delegate="purchaseController.addContactDelegate" resultPage="this"/>
</t:block>

<t:block t:id="contactEditor">
	<span t:type="checkout/contact/contacteditor" delegate="purchaseController.contactEditorDelegate" blockToRefresh="checkoutBlock"/>
</t:block>

<t:block t:id="paymentEditor">
	<span t:type="checkout/payment/paymenteditor" delegate="purchaseController.paymentEditorDelegate"/>
</t:block>

<t:block t:id="paymentResult">
	<span t:type="checkout/payment/paymentresult" delegate="purchaseController.paymentEditorDelegate"/>
</t:block>

<link href="${asset:context:css/_checkout.css}" media="screen, print" rel="stylesheet" />
<script type="text/javascript" src="${asset:context:js/jquery.blockUI.js}"/>
<script type="text/javascript" src="${asset:context:js/_checkout.js}"/>
</html>
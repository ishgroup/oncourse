<html t:type="ui/internal/pagestructure" bodyId="literal:EnrolmentEntry"
	  bodyClass="literal:internal-page"
	  xmlns:t="http://tapestry.apache.org/schema/tapestry_5_1_0.xsd">

<div id="checkout">
		<t:delegate to="block:checkout"/>
</div>

<t:block t:id="checkout">
	<t:delegate to="block:errors"/>
	<t:if test="purchaseController.editCheckout">
		<t:delegate to="block:payments"/>
	</t:if>
	<t:if test="purchaseController.editConcession">
		<t:delegate to="block:concessionEditor"/>
	</t:if>
	<t:if test="purchaseController.addContact">
		<t:delegate to="block:addContact"/>
	</t:if>
	<t:if test="purchaseController.editContact">
		<t:delegate to="block:contactEditor"/>
	</t:if>
	<t:if test="purchaseController.editPayment">
		<t:delegate to="block:paymentEditor"/>
	</t:if>
	<t:if test="purchaseController.finalized">
		<p>The process was canceled. Reply the checkout again.</p>
		<script type="text/javascript">
			refreshShortList();
			<t:if test="coursesLink">
					setTimeout("window.location.href='${coursesLink}'", 10000);
			</t:if>
		</script>
	</t:if>
</t:block>

<t:block t:id="errors">
	<t:if test="purchaseController.errors.isEmpty()" negate="true">
		<div class="error">
			<h2>ERROR</h2>
			<t:loop source="purchaseController.errors" value="error">
				<p>${error}</p>
			</t:loop>
		</div>
	</t:if>
</t:block>

<t:block t:id="payments">
	<table class="payments">
		<span t:type="checkout/contactlist" purchaseController="purchaseController" blockToRefresh="checkoutBlock"/>
		<tbody class="t-update t-zone" id="totals">
		<tr>
			<td>
				<div id="addContact">Add another student</div>
				<t:eventlink t:id="addContactEvent" style="{display:none}"/>
			</td>
			<td class="alignright">Total</td>
			<td id="total" class="alignright">
				<span class="totalPrice">${purchaseController.totalIncGst}</span>
			</td>
		</tr>
		</tbody>
	</table>

	<div class="amount-container">
		<span t:type="checkout/addcode" purchaseController="purchaseController"/>
		<span t:type="checkout/amount" purchaseController="purchaseController"/>
		<button id="proceedToPayment" class="btn btn-primary">Proceed to Payment</button>
		<t:eventlink t:id="proceedToPaymentEvent" style="{display:none}"/>
	</div>
</t:block>

<t:block t:id="concessionEditor">
	<span t:type="checkout/concession/concessionEditor" delegate="purchaseController.concessionDelegate"/>
</t:block>

<t:block t:id="addContact">
	<span t:type="checkout/contact/addcontact" delegate="purchaseController.addContactDelegate" blockToRefresh="checkoutBlock"/>
</t:block>

<t:block t:id="contactEditor">
	<span t:type="checkout/contact/contacteditor" delegate="purchaseController.contactEditorDelegate" blockToRefresh="checkoutBlock"/>
</t:block>

<t:block t:id="paymentEditor">
	<span t:type="checkout/payment/paymenteditor" delegate="purchaseController.paymentEditorDelegate"/>
</t:block>

</html>
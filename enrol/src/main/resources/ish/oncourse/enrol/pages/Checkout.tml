<html t:type="ui/internal/pagestructure" bodyId="literal:CheckoutPage"
	  bodyClass="literal:internal-page"
	  xmlns:t="http://tapestry.apache.org/schema/tapestry_5_1_0.xsd">

<div id="checkout" class="payments">
	<t:delegate to="block:checkout"/>
</div>


<t:block t:id="checkout">
	<t:if test="purchaseController">
        <t:delegate to="block:progress"/>
		<t:delegate to="block:errors"/>
		<t:if test="purchaseController.editCheckout">
			<t:delegate to="block:payments"/>
		</t:if>
		<t:if test="purchaseController.editConcession">
			<t:delegate to="block:concessionEditor"/>
		</t:if>
		<t:if test="purchaseController.addContact">
			<t:delegate to="block:addContact"/>
		</t:if>
		<t:if test="purchaseController.editContact">
			<t:delegate to="block:contactEditor"/>
		</t:if>
	</t:if>
</t:block>

<t:block t:id="progress">
    <span t:type="checkout/progress" purchaseController="purchaseController"/>
</t:block>

<t:block t:id="errors">
	<span t:type="checkout/errors" validationResult="purchaseController.validationResult"/>
</t:block>

<t:block t:id="payments">
    <div>
        <table class="payments">
            <span t:type="checkout/contactlist" purchaseController="purchaseController" blockToRefresh="checkoutBlock"/>
            <tbody class="t-update t-zone" id="totals">
            <tr>
                <td colspan="3">
                    <div id="addContact">Add another student</div>
                    <t:eventlink t:id="addContactEvent" style="{display:none}"/>
                </td>
            </tr>
            </tbody>
        </table>
        <div class="amount-container">
            <span t:type="checkout/addcode" purchaseController="purchaseController" blockToRefresh="checkoutBlock"/>
            <span t:type="checkout/amount" purchaseController="purchaseController" blockToRefresh="checkoutBlock" showPayerFields="false"/>
            <!-- the code need to clear the floats.-->
            <div class="clearboth"></div>
            <t:checkout.nextbutton/>
        </div>
    </div>
</t:block>

<t:block t:id="concessionEditor">
	<span t:type="checkout/concession/concessionEditor" delegate="purchaseController.concessionDelegate"/>
</t:block>

<t:block t:id="addContact">
	<span t:type="checkout/contact/addcontact" delegate="purchaseController.addContactDelegate" returnPage="this" showCancelLink="purchaseController.payerInitialized"/>
</t:block>

<t:block t:id="contactEditor">
	<span t:type="checkout/contact/contacteditor" delegate="purchaseController.contactEditorDelegate"
		  returnPage="this" returnBlock="checkoutBlock" showCancelLink="purchaseController.payerInitialized"/>
</t:block>

<t:block t:id="paymentEditor">
	<span t:type="checkout/payment/paymenteditor" delegate="purchaseController.paymentEditorDelegate"/>
</t:block>

<t:block t:id="paymentResult">
	<span t:type="checkout/payment/paymentresult" delegate="purchaseController.paymentEditorDelegate"/>
</t:block>

<link rel="stylesheet" type="text/css" href="${request.contextPath}/css/enrol.css"/>
<script type="text/javascript" src="${request.contextPath}/js/enrol-min.js"></script>

</html>
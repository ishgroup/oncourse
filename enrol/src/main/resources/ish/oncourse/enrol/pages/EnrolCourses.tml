<html t:type="ui/pagestructure" bodyId="literal:EnrolmentEntry" bodyClass="literal:internal-page"
	xmlns:t="http://tapestry.apache.org/schema/tapestry_5_1_0.xsd"
	xmlns:p="tapestry:parameter">
	<t:if test="classesToEnrol">
		<script type="text/javascript">
			var enrolmentEntryDisplayed = true;
		</script>
		<t:if test="hadPreviousPaymentFailure">
			<div class="error">
				<h2>Enrolment <span>&#187;</span> Payment rejected</h2>
				<p>${message:enrolmentError}</p>
				<p>${message:checkCreditCard}</p>
			</div>
		</t:if>

		<!-- start has students -->
		<t:if test="contacts">
			<!-- start enrolments summary -->
			<table class="payments">
				<colgroup>
					<col/>
					<col width="80"/>
					<col width="80"/>
				</colgroup>
				<t:loop source="contacts" value="contact" index="studentIndex">
					<thead>
						<tr>
							<th colspan="3">
								<div class="left">${contact.fullName} <span>- ${contact.emailAddress}</span></div>
								<div class="right">
									<t:if test="showConcessionsArea">
										<a id="add-concession_${studentIndex}" class="add-concession">
											<span>Add Concession</span>
										</a>
									</t:if>
								</div>
							</th>
						</tr>
						<t:if test="showConcessionsArea">
							<tr colspan="3"><th colspan="3"><span t:type="ConcessionEntry" student="contact.student" index="studentIndex"/></th></tr>
						</t:if>	
					</thead>
					<tbody>
					
						<t:loop source="classesToEnrol" value="courseClass" index="courseClassIndex">
							<span t:type="EnrolmentListItem" studentIndex="studentIndex" courseClassIndex="courseClassIndex"/>
						</t:loop>
					</tbody>
				</t:loop>
				
				<t:zone t:id="totals" class="totals" elementName="tbody">
					<t:if test="hasDiscount">
						<tr>
							<td colspan="2" class="alignright">Discount</td>
							<td class="alignright" id="discounttotal">
								<t:output value="totalDiscountAmountIncTax" format="moneyFormat"/>
							</td>
						</tr>
					</t:if>
					<tr>
						<td><span id="addstudent">Add another student</span></td>
						<td class="alignright">Total</td>
						<td class="alignright" id="total">
							<t:output value="totalIncGst" format="moneyFormat"/>
						</td>
					</tr>
				</t:zone>
			</table>
		</t:if>

		<span t:type="EnrolmentContactEntry" showConcessionsArea="showConcessionsArea"/>

		<!-- end enrolments summary -->
		<t:if test="contacts">
			<!-- start payment form -->
			<span t:type="EnrolmentPaymentEntry" t:id="paymentEntry" totalIncGst="totalIncGst" 
				payers="contacts" payment="payment" invoice="invoice" enrolments="enrolmentsList"/>
			<!-- end payment form -->
		</t:if>
		<p:else>
			<h3>Add a student</h3>
			<div class="error">
				<p>You do not have any classes in your order as yet. Please <a href="${coursesListLink}">select a class</a> from the courses available.</p>
			</div>
		</p:else>
	</t:if>
	<script type="text/javascript">
		Event.observe('totals', Tapestry.ZONE_UPDATED_EVENT, function(){
			initAddStudentButton();
		});
	</script>
<!-- end has classes -->
</html>
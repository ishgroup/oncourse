<html t:type="ui/pagewrapper" bodyId="literal:EnrolmentEntry"
	xmlns:t="http://tapestry.apache.org/schema/tapestry_5_1_0.xsd"
	xmlns:p="tapestry:parameter">
<t:if test="classesToEnrol">
	<script type="text/javascript">
	var enrolmentEntryDisplayed = true;
</script>
	<t:if test="hadPreviousPaymentFailure">
		<div class="error">
		<h2>Enrolment <span>&#187;</span> Payment rejected</h2>
		<p>Your enrolment could not be completed because your credit card
		payment could not be authorised. Your credit card has not been
		charged.</p>
		<p>Please check your credit card details or credit balance and try
		again. In particular, check the CVV and expiry date have been entered
		correctly.</p>
		</div>
	</t:if>

	<!-- wo:ISHValidationContainer keyPath="attemptSave" object="$parentPage">
		<div class="error">
		<p><wo:ISHValidationMessage keyPath="attemptSave"
			object="$parentPage" /></p>
		</div>
	</wo:ISHValidationContainer-->

	<!-- start has students -->
	<!-- start enrolment form -->
	<t:form t:id="enrolmentform">
		<t:errors />
		<!-- t:submit t:id="refresh" value="Refresh totals" class="btnhidden" /-->
		<t:if test="students">
			<!-- start enrolments summary -->
			<table class="payments">
				<colgroup>
					<col/>
					<col width="80"/>
					<col width="80"/>
				</colgroup>
				<t:loop source="students" value="student">
					<thead>
						<tr>
							<th colspan="3">
							<div class="left">${student.contact.fullName} <span>-
							${student.contact.emailAddress}</span></div>
							<div class="right"><t:if test="showConcessionsArea">
								<t:actionlink t:id="addStudentConcession"
									title="Add a concession" class="add-concession">
									<span>Add Concession</span>
								</t:actionlink></t:if></div>
							</th>
						</tr>
					</thead>
					<tbody>
						<t:loop source="classesToEnrol" value="courseClass">
							<!-- wo:EnrolmentListItem student="$studentItem"
								courseClass="$classItem" index="$enrolmentIndex" /-->
						</t:loop>
					</tbody>
				</t:loop>

				<tbody class="totals">
					<!-- wo:ISHKeyValueConditional key="payment.totalDiscountAmount"
						value="$0" operator="gt">
						<tr>
							<td colspan="2" class="alignright">Discount</td>
							<td class="alignright" id="discounttotal"><wo:string
								value="$payment.totalDiscountAmountIncTax"
								numberformat="###,##0.00" /></td>
						</tr>
					</wo:ISHKeyValueConditional>
					<tr>
						<td><span id="addstudent">Add another student</span></td>
						<td class="alignright">Total</td>
						<td class="alignright" id="total"><wo:string
							value="$payment.totalIncGst" numberformat="###,##0.00" /></td>
					</tr-->
				</tbody>
			</table>
		</t:if>

		<!-- wo:EnrolmentContactEntry /-->

		<!-- end enrolments summary -->
		<noscript>
		<div class="form-controls"><t:submit t:id="refresh"
			value="Refresh totals" class="btn" /></div>
		</noscript>
		<t:if test="students">
			<!-- start payment form -->
			<!-- wo:EnrolmentPaymentEntry callback="attemptSave"
				enrolmentController="$enrolmentController"
				validationExceptions="$validationExceptions" /-->
			<!-- end payment form -->
		</t:if>
	</t:form>

	<!-- end enrolment form -->
	<p:else>
		<h3>Add a student</h3>
		<div class="error">
		<p>You do not have any classes in your order as yet. Please <a
			href="${coursesListLink}">select a class</a> from the courses
		available.</p>
		</div>
	</p:else>
</t:if>

<!-- end has classes -->
</html>
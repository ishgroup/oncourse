<html t:type="ui/internal/pagestructure" bodyId="literal:EnrolmentEntry"
	bodyClass="literal:internal-page"
	xmlns:t="http://tapestry.apache.org/schema/tapestry_5_1_0.xsd"
	xmlns:p="tapestry:parameter">
	<script t:type="ui/jsassetgroup" group="literal:core-enrol" />
<t:if test="controller.checkoutResult">
	<t:EnrolmentPaymentProcessing t:id="resultComponent" />
	<p:else>
		<t:if test="paymentGatewayEnabled">
			<t:if test="model.classesToEnrol">
				<script type="text/javascript">
					var enrolmentEntryDisplayed = true;
				</script>
				<t:if test="controller.hadPreviousPaymentFailure">
					<div class="error">
					<h2>Enrolment <span>&#187;</span> Payment rejected</h2>
					<p>${message:enrolmentError}</p>
					<p>${message:checkCreditCard}</p>
					</div>
				</t:if>

				<!-- start has students -->
				<t:if test="model.contacts">
					<t:zone t:id="payersZone" t:update="show">
					<!-- start enrolments summary -->
					<table class="payments">
						<colgroup>
							<col />
							<col width="80" />
							<col width="80" />
						</colgroup>
						<t:loop source="model.contacts" value="contact" index="studentIndex">
							<thead>
								<tr>
									<th colspan="3">
									<div class="left">${contact.fullName} <span>-
									${contact.emailAddress}</span>
									</div>
									<t:if test="payer">
										<span class="payer" style="padding-right:5px;">Payer</span>
										<t:form t:id="payerForm" zone="payersZone">
										<span class="valid">
											<t:select t:id="currentPayer" value="model.contact" model="payersModel" encoder="payersEncoder" 
												blankOption="NEVER" zone="payersZone"/>
										</span>
										</t:form>
									</t:if>
									<div class="right"><t:if test="showConcessionsArea">
										<a id="add-concession_${studentIndex}" class="add-concession">
										<span>Add Concession</span> </a>
									</t:if></div>
									</th>
								</tr>
								<t:if test="showConcessionsArea">
									<tr colspan="3">
										<th colspan="3"><span t:type="ConcessionEntry"
											index="studentIndex" /></th>
									</tr>
								</t:if>
							</thead>
							<tbody>
								<span t:type="ContactEnrolmentList" classes="model.classesToEnrol" studentIndex="studentIndex"/>
							</tbody>
						</t:loop>

						<t:zone t:id="totals" class="t-update" elementName="tbody">
							<t:if test="controller.hasDiscount">
								<tr>
									<td colspan="2" class="alignright">Discount</td>
									<td class="alignright" id="discounttotal"><t:output
										value="controller.totalDiscountAmountIncTax" format="model.moneyFormat" /></td>
								</tr>
							</t:if>
							<tr>
								<td><span id="addstudent">Add another student</span></td>
								<td class="alignright">Total</td>
								<td class="alignright" id="total"><t:output
									value="controller.totalIncGst" format="model.moneyFormat" /></td>
							</tr>
						</t:zone>
					</table>
					</t:zone>
				</t:if>

				<span t:type="EnrolmentContactEntry" />

				<!-- end enrolments summary -->
				<t:if test="model.contacts">
					<!-- start payment form -->
					<span t:type="EnrolmentPaymentEntry" t:id="paymentEntry"/>
					<!-- end payment form -->
				</t:if>
				<p:else>
					<h3>Add a student</h3>
					<div class="error">
					<p>You do not have any classes in your order as yet. Please <a
						href="${coursesListLink}">select a class</a> from the courses
					available.</p>
					</div>
				</p:else>
			</t:if>
			<p:else>
				Payment gateway processing is disabled for this college.
			</p:else>
		</t:if>

		<script type="text/javascript">
			Event.observe('totals', Tapestry.ZONE_UPDATED_EVENT, function(){
				initAddStudentButton();
			});
		</script>

		<!-- end has classes -->
		
	</p:else>
</t:if>
<t:actionLink t:id="checkSession"/>
</html>
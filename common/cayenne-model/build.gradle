plugins {
    id 'java-library'
}
apply plugin: 'org.apache.cayenne'

sourceSets {
    main {
        groovy {
            srcDirs += "${buildDir}/generated-resources/main/java"
        }
    }
}

dependencies {
    api ("ish.oncourse:types:$typesVersion") {
        //we should exclude cayenne-server from waCommon because the cayenne-server is not compatable to willow code.
        exclude group: 'org.apache.cayenne', module: 'cayenne-server'
    }
    api ('commons-validator:commons-validator:1.5.0'){
        //the lib (version 2.1) conflicts with commons-collections (ver 3.2.1) from org.apache.cayenne group dependences
        exclude group:'commons-collections', module: 'commons-collections'
    }

    api "commons-lang:commons-lang:2.6"
    api "org.apache.cayenne:cayenne-server:$cayenneVersion"
    api "org.apache.cayenne:cayenne-lifecycle:$cayenneVersion"
    api 'concurrent:concurrent:1.3.4'

    api 'oro:oro:2.0.8'
    api ('org.liquibase:liquibase-core:3.6.3') {
        exclude group: 'ch.qos.logback', module: 'logback-classic'
    }
    /**
     * 	we use the lib to validate email address
     * 	also we use the lib for our MailService from common-services projects
     */
    api 'javax.mail:mail:1.4.7'
    api 'javax.activation:activation:1.1.1'

    testImplementation project(':common:test-functions')
    testImplementation "org.apache.cayenne:cayenne-cache-invalidation:$cayenneVersion"
}

cgen {
    map 'src/main/resources/oncourse.map.xml'
    superPkg 'ish.oncourse.model.auto'
    makePairs true
    mode 'entity'
    createPropertyNames true
    destDir = file("${buildDir}/generated-resources/main/java")
    doLast {
        // remove subclass files which are already committed inside the app
        delete fileTree("${buildDir}/generated-resources/main/java/ish/oncourse/model") {
            exclude '**/auto/*'
        }
    }
}

compileJava.dependsOn(cgen)

apply from: "$rootDir/gradle/cxf-spring.gradle"

dependencies {
    compile (project(':common:common-services')) {
        exclude group: 'axis'
    }
    compile ("ish.oncourse.willow:waCommon:$waCommonWebservicesClientVersion") {
        exclude group: 'org.apache.cayenne', module: 'cayenne-server'
    }

    compile 'org.springframework:spring-beans:3.0.5.RELEASE'
    compile 'org.bouncycastle:bcprov-jdk15:1.45'

    testCompile 'org.springframework:spring-context:3.1.0.RELEASE'
    testCompile 'cglib:cglib:2.2.2'
}

jar {
    manifest {
        from sharedManifest
    }
}


configurations {
    ws
}

dependencies{
    ws "org.apache.cxf:cxf-tools:${cxfVersion}",
            "org.apache.cxf:cxf-tools-wsdlto-databinding-jaxb:${cxfVersion}",
            "org.apache.cxf:cxf-tools-wsdlto-frontend-jaxws:${cxfVersion}",
            "org.jvnet.jaxb2_commons:jaxb2-basics:0.6.5"
    "log4j:log4j:1.2.17"
}

project.ext {
    wsdlDir = file("${projectDir}/src/main/resources/wsdl")
    generatedWsdlDir = file("${projectDir}/src/main/java")
    wsdlsToGenerate = [
            [       '-wsdlLocation', "/wsdl/USIServiceV2.wsdl",
                    '-b', "$wsdlDir/usi_bindings.xml",
                    "-client",
                    "$wsdlDir/USIServiceV2.wsdl"],
    ]
}

task wsdl2Java() {
    inputs.files wsdlDir.listFiles()
    outputs.files generatedWsdlDir

    doLast {
        wsdlsToGenerate.each { argsin ->
            argsin.add(argsin.size - 1, '-d')
            argsin.add(argsin.size - 1, generatedWsdlDir)
            javaexec {
                classpath configurations.ws
                main = 'org.apache.cxf.tools.wsdlto.WSDLToJava'
                args = argsin
                systemProperties = ['exitOnFinish':'TRUE']
            }
        }
    }
}


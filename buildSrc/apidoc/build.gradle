apply plugin: 'groovy'

repositories {
    maven {
        url 'https://repo.ish.com.au/content/groups/public'
    }
}

dependencies {
	implementation gradleApi()
	implementation 'antlr:antlr:2.7.7'
	implementation 'org.apache.ant:ant-antlr:1.9.6'
	implementation project.fileTree(include: ['*.jar'], dir: "${project.rootDir}/buildSrc/apidoc/build/libs/")

	testImplementation 'junit:junit:4.11'
}


task generateGrammar {
	description = 'Ensure all the Antlr generated files are up to date.'
	ext.antlrDirectory = "$projectDir/src/main/java/au/com/ish/docs/antlr"
	ext.javaParserDirectory = "$ext.antlrDirectory"
	ext.genPath = "$ext.antlrDirectory"
	ext.groovyOutDir = "$ext.genPath/groovy"
	ext.javaOutDir = "$ext.genPath/java"
	inputs.dir(antlrDirectory)
	outputs.dir(groovyOutDir)
	outputs.dir(javaOutDir)
	doFirst {
		new File(groovyOutDir).mkdirs()
		new File(javaOutDir).mkdirs()
		ant {
			taskdef(name: 'antlr',
					classname: 'org.apache.tools.ant.taskdefs.optional.ANTLR',
					classpath: configurations.antlr.asPath)

			antlr(target: "$ext.antlrDirectory/groovy.g", outputdirectory: ext.groovyOutDir) {
				classpath path: configurations.compile.asPath
			}
			antlr(target: "$ext.javaParserDirectory/java.g", outputdirectory: ext.javaOutDir) {
				classpath path: configurations.compile.asPath
			}
		}
	}
}

apply plugin: 'com.moowork.node'

node {
    version = '9.3.0'
    npmVersion = '5.5.1'
    download = true
}

task webpack(type: NodeTask, dependsOn: 'yarn_install') {
    script = file('node_modules/.bin/webpack')
    args = ['--progress', '-p', '--env.NODE_ENV', 'production', '--env.BUILD_NUMBER', version ?: 'SNAPSHOT']
}

task jest(type: NodeTask, dependsOn: 'yarn_install') {
    script = project.file('node_modules/.bin/jest')
    args = ['--ci', '--testResultsProcessor=jest-junit']
}


sourceSets {
    main.resources.srcDirs 'src/js', 'src/dev'
    swagger.resources.srcDir 'build/generated-sources'
}

test.dependsOn(jest)

build.dependsOn(webpack)
build.dependsOn(":editor-api:swagger")

publishing {
    publications {
        executables(MavenPublication) {
            artifact(file("${buildDir}/distribution/${project.name}.zip")) {
                classifier "executable"
                extension "zip"
                builtBy build
            }
        }
    }
}
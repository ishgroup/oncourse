databaseChangeLog:

  - changeSet:
      id: 108-1
      author: dmitrij
      preConditions:
        - onFail: HALT
        - not:
            - tableExists:
                tableName: Cart
      changes:
        - createTable:
            tableName: Cart
            columns:
              - column:
                  constraints:
                    nullable: false
                  name: contactId
                  type: BIGINT
              - column:
                  constraints:
                    nullable: false
                  name: payerId
                  type: BIGINT
              - column:
                  constraints:
                    nullable: false
                  name: checkoutUrl
                  type: VARCHAR(128)
              - column:
                  autoIncrement: true
                  constraints:
                    nullable: false
                    primaryKey: true
                  name: id
                  type: BIGINT
              - column:
                  constraints:
                    nullable: false
                  defaultValueComputed: current_timestamp()
                  name: createdOn
                  type: timestamp
              - column:
                  constraints:
                    nullable: false
                  defaultValueComputed: current_timestamp()
                  name: modifiedOn
                  type: timestamp

  - changeSet:
      id: 108-2
      author: dmitriy
      preConditions:
        - onFail: HALT
        - not:
            - foreignKeyConstraintExists:
                foreignKeyName: fk_Cart_Payer
            - foreignKeyConstraintExists:
                foreignKeyName: fk_Cart_Contact
      changes:
        - addForeignKeyConstraint:
            baseColumnNames: contactId
            baseTableName: Cart
            constraintName: fk_Cart_Contact
            referencedColumnNames: id
            referencedTableName: Contact
        - addForeignKeyConstraint:
            baseColumnNames: payerId
            baseTableName: Cart
            constraintName: fk_Cart_Payer
            referencedColumnNames: id
            referencedTableName: Contact

  - changeSet:
      id: 108-3
      author: dmitriy
      preConditions:
        - onFail: HALT
        - and:
            - not:
                - columnExists:
                    tableName: CourseClass
                    columnName: cartId
                - columnExists:
                    tableName: WaitingList
                    columnName: cartId
                - columnExists:
                    tableName: Product
                    columnName: cartId
      changes:
        - addColumn:
            tableName: CourseClass
            columns:
              - column:
                  name: cartId
                  type: BIGINT
                  constraints:
                    nullable: true
        - addColumn:
            tableName: WaitingList
            columns:
              - column:
                  name: cartId
                  type: BIGINT
                  constraints:
                    nullable: true
        - addColumn:
            tableName: Product
            columns:
              - column:
                  name: cartId
                  type: BIGINT
                  constraints:
                    nullable: true
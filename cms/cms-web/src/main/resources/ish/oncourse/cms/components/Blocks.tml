<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<div xmlns:t="http://tapestry.apache.org/schema/tapestry_5_1_0.xsd"
	xmlns:p="tapestry:parameter" lang="en">
	
	<t:block t:id="editBlock">
		<span t:type="blockedit" block="prop:selectedBlock" updateZone="prop:blockZone"/>
	</t:block>
	
	<t:zone t:id="blockZone">
	
		<a href="#" t:type="actionLink" t:id="newBlock" zone="blockZone" class="button">New Block</a> 
		
		<input id="blockFilter" type="text" value=""/>
		
		<h1>Blocks</h1>
		
		<table id="blocks">
			<t:loop source="webContentService.blocks" value="block">
				<tr id="${block.id}">
					<td><a href="#" t:type="actionLink" t:id="editBlock" t:zone="blockZone" t:context="block.id">${block.name}</a></td> 
					<td><t:outputraw value="lastEdited"/></td>
				</tr>
			</t:loop>
		</table>
		
		<style>
			.selectedRow {
				background-color: yellow;
				cursor: pointer;
			 }
		</style>
		
		<script type="text/javascript">
			jQuery(function() {
				jQuery('#blockFilter').search('#blocks tr', function(on) {
		            on.all(function(results) {
		             
		            });
	
		            on.reset(function() {
		              jQuery('#blocks tr').show();
		            });
	
		            on.empty(function() {
		              jQuery('#blocks tr').hide();
		            });
	
		            on.results(function(results) {
		              jQuery('#blocks tr').hide();
		              results.show();
		            });
		          });
				
				jQuery('#blocks tbody tr').mouseover(function() {
					jQuery(this).addClass('selectedRow');
				}).mouseout(function() {
				    jQuery(this).removeClass('selectedRow');
				}).click(function() {
					var zoneManager = Tapestry.findZoneManagerForZone('blockZone');
					zoneManager.updateFromURL('${editBlockUrl}' + jQuery(this).attr('id'));
				});
			});
		</script>
	
	</t:zone>
</div>
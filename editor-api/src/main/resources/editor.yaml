swagger: '2.0'
info:
  title: Editor Api
  description: Public editor API
  termsOfService: http://example.com/terms/
  contact:
    name: ish group pty ltd
    url: http://ish.com.au
    email: support@ish.com.au
  license:
    name: Closed


schemes:
  - https
produces:
  - application/json
securityDefinitions:
  basicAuth:
    type: basic
    description: HTTP Basic Authentication


paths:
  /getUser:
    post:
      operationId: getUser
      summary: Get user by email and password
      description: Get user by email and password (Login)
      tags:
        - Auth
      consumes:
        - application/json
      parameters:
        - name: loginRequest
          in: body
          description: Params for request user authorization
          required: true
          schema:
            $ref: '#/definitions/api.LoginRequest'
      responses:
        '200':
          description: User
          schema:
            $ref: '#/definitions/User'
        default:
          description: Unexpected error
          schema:
            $ref: '#/definitions/common.CommonError'

  /logout:
    post:
      operationId: logout
      summary: De-authorize user from editor
      tags:
        - Auth
      consumes:
        - application/json
      responses:
        '200':
          description: Success logout witn null response
        default:
          description: Unexpected error
          schema:
            $ref: '#/definitions/common.CommonError'

  /getMenuItems:
    get:
      x-filter:  
      - AuthFilter
      operationId: getMenuItems
      summary: Get menu items
      description: Get menu items
      tags:
        - Menu
      responses:
        '200':
          description: Menu reposonse object
          schema:
            type: array
            items:
              $ref: '#/definitions/MenuItem'
        default:
          description: Unexpected error
          schema:
            $ref: '#/definitions/common.CommonError'

  /saveMenuItems:
    post:
      x-filter:  
      - AuthFilter
      operationId: saveMenuItems
      summary: Save menu items
      description: Save menu items
      tags:
        - Menu
      consumes:
        - application/json
      parameters:
        - name: Menu
          in: body
          description: Menu items
          required: true
          schema:
            type: array
            items:
              $ref: '#/definitions/MenuItem'
      responses:
        '200':
          description: Menu items
          schema:
            type: array
            items:
              $ref: '#/definitions/MenuItem'
        default:
          description: Unexpected error
          schema:
            $ref: '#/definitions/common.CommonError'

  /getPages:
    get:
      x-filter:  
      - AuthFilter
      operationId: getPages
      summary: Get pages
      description: Get pages
      tags:
        - Page
      responses:
        '200':
          description: response with array of pages
          schema:
            type: array
            items:
              $ref: '#/definitions/Page'
        default:
          description: Unexpected error
          schema:
            $ref: '#/definitions/common.CommonError'
  /getPageByUrl:
    get:
      x-filter:  
      - AuthFilter
      summary: Get page by provided page url
      operationId: getPageByUrl
      description: Get page object by provided page url
      tags:
        - Page
      parameters:
        - name: pageUrl
          in: query
          description: Page url
          required: true
          type: string
      responses:
        '200':
          description: Page for provided url
          schema:
            $ref: '#/definitions/Page'
        default:
          description: Unexpected error
          schema:
            $ref: '#/definitions/common.CommonError'
  /savePage:
    post:
      x-filter:  
      - AuthFilter
      summary: Save page parameters
      operationId: savePage
      description: Save page parameters
      tags:
        - Page
      consumes:
        - application/json
      parameters:
        - name: pageParams
          in: body
          description: page with new params
          required: true
          schema:
            $ref: '#/definitions/Page'
      responses:
        '200':
          description: Page object with updated params
          schema:
            $ref: '#/definitions/Page'
        default:
          description: Unexpected error
          schema:
            $ref: '#/definitions/common.CommonError'

  /addPage:
    post:
      x-filter:  
      - AuthFilter
      summary: Add new page
      operationId: addPage
      description: Add new page
      tags:
        - Page
      consumes:
        - application/json
      responses:
        '200':
          description: new page with unique id and url
          schema:
            $ref: '#/definitions/Page'
        default:
          description: Unexpected error
          schema:
            $ref: '#/definitions/common.CommonError'

  /deletePage/{pageNumber}:
    post:
      x-filter:  
      - AuthFilter
      summary: Remove page by provided number
      operationId: deletePage
      description: Remove page by number
      tags:
        - Page
      consumes:
        - application/json
      parameters:
        - name: pageNumber
          in: path
          description: number of page which will be deleted
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Page successfully deleted
        default:
          description: Unexpected error
          schema:
            $ref: '#/definitions/common.CommonError'

  /getBlocks:
    get:
      x-filter:  
      - AuthFilter
      summary: Get list of blocks
      operationId: getBlocks
      tags:
        - Block
      responses:
        '200':
          description: response with array of blocks
          schema:
            type: array
            items:
              $ref: '#/definitions/Block'
        default:
          description: Unexpected error
          schema:
            $ref: '#/definitions/common.CommonError'

  /saveBlock:
    post:
      x-filter:  
      - AuthFilter
      summary: Update an existing block
      operationId: saveBlock
      description: Save block params
      tags:
        - Block
      consumes:
        - application/json
      parameters:
        - name: SaveBlockRequest
          in: body
          description: Block with new params
          required: true
          schema:
            $ref: '#/definitions/Block'
      responses:
        '200':
          description: Block object with updated params
          schema:
            $ref: '#/definitions/Block'
        default:
          description: Unexpected error
          schema:
            $ref: '#/definitions/common.CommonError'

  /addBlock:
    post:
      x-filter:  
      - AuthFilter
      summary: Add new block
      operationId: addBlock
      description: Add new block
      tags:
        - Block
      consumes:
        - application/json
      responses:
        '200':
          description: new block with unique id
          schema:
            $ref: '#/definitions/Block'
        default:
          description: Unexpected error
          schema:
            $ref: '#/definitions/common.CommonError'

  /deleteBlock/{name}:
    post:
      x-filter:  
      - AuthFilter
      summary: Remove block by provided Id
      operationId: deleteBlock
      description: Remove block
      tags:
        - Block
      consumes:
        - application/json
      parameters:
        - name: name
          in: path
          description: idenifier of block which will be deleted
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Block successfully deleted
        default:
          description: Unexpected error
          schema:
            $ref: '#/definitions/common.CommonError'

  /getThemes:
    get:
      x-filter:  
      - AuthFilter
      summary: Get array of themes
      operationId: getThemes
      description: Get array of themes
      tags:
        - Theme
      responses:
        '200':
          description: response with array of themes
          schema:
            type: array
            items:
              $ref: '#/definitions/Theme'
        default:
          description: Unexpected error
          schema:
            $ref: '#/definitions/common.CommonError'
  /getLayouts:
    get:
      x-filter:  
      - AuthFilter
      summary: Get array of layouts
      operationId: getLayouts
      description: Get array of layouts
      tags:
        - Theme
      responses:
        '200':
          description: response with array of layouts
          schema:
            type: array
            items:
              $ref: '#/definitions/Layout'
        default:
          description: Unexpected error
          schema:
            $ref: '#/definitions/common.CommonError'
  /saveTheme:
    post:
      x-filter:  
      - AuthFilter
      summary: Theme with updated params
      operationId: saveTheme
      description: Save theme params
      tags:
        - Theme
      consumes:
        - application/json
      parameters:
        - name: SaveThemeRequest
          in: body
          description: Theme with new params
          required: true
          schema:
            $ref: '#/definitions/Theme'
      responses:
        '200':
          description: Theme object with updated params
          schema:
            $ref: '#/definitions/Theme'
        default:
          description: Unexpected error
          schema:
            $ref: '#/definitions/common.CommonError'
  /addTheme:
    post:
      x-filter:  
      - AuthFilter
      summary: Add new theme
      operationId: addTheme
      description: Add new theme
      tags:
        - Theme
      consumes:
        - application/json
      responses:
        '200':
          description: new theme with unique id
          schema:
            $ref: '#/definitions/Theme'
        default:
          description: Unexpected error
          schema:
            $ref: '#/definitions/common.CommonError'
  /deleteTheme/{themeName}:
    post:
      x-filter:  
      - AuthFilter
      summary: Remove theme by provided name
      operationId: deleteTheme
      description: Remove theme
      tags:
        - Theme
      consumes:
        - application/json
      parameters:
        - name: themeName
          in: path
          description: identificator of theme which will be deleted
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Theme successfully deleted
        default:
          description: Unexpected error
          schema:
            $ref: '#/definitions/common.CommonError'

  /getVersions:
    get:
      x-filter:  
      - AuthFilter
      summary: Get array of published versions. Not supported yet
      operationId: getVersions
      description: Get array of published versions. Not supported yet
      tags:
        - Publish
      responses:
        '200':
          description: response with array of published versions
          schema:
            type: array
            items:
              $ref: '#/definitions/Version'
        default:
          description: Unexpected error
          schema:
            $ref: '#/definitions/common.CommonError'

  /setVersion:
    post:
      x-filter:  
      - AuthFilter
      summary: Set current published version by provided version Id. Not supported yet
      operationId: setVersion
      tags:
        - Publish
      consumes:
        - application/json
      parameters:
        - name: SetVersionRequest
          in: body
          description: Version id
          required: true
          schema:
            $ref: '#/definitions/api.SetVersionRequest'
      responses:
        '200':
          description: Version changed successfully
        default:
          description: Unexpected error
          schema:
            $ref: '#/definitions/common.CommonError'

  /publish:
    post:
      x-filter:  
      - AuthFilter
      summary: Publish current draft version. Support basic Authentication
      operationId: publish
      description: Publish current draft changes to live site. Support basic Authentication
      tags:
        - Publish
      consumes:
        - application/json
      responses:
        '200':
          description: Draft changes has been published
        default:
          description: Unexpected error
          schema:
            $ref: '#/definitions/common.CommonError'

  /getCheckoutSettings:
    get:
      x-filter:  
      - AuthFilter
      operationId: getCheckoutSettings
      summary: Get checkout settings
      description: Get checkout settings
      tags:
        - Settings
      responses:
        '200':
          description: response with checkout settings object
          schema:
            $ref: '#/definitions/settings.CheckoutSettings'
        default:
          description: Unexpected error
          schema:
            $ref: '#/definitions/common.CommonError'

  /setCheckoutSettings:
    post:
      x-filter:  
      - AuthFilter
      summary: Save checkout settings
      operationId: setCheckoutSettings
      description: Save checkout settings
      tags:
        - Settings
      consumes:
        - application/json
      parameters:
        - name: SaveCheckoutSettingsRequest
          in: body
          description: Checkout settings object
          required: true
          schema:
            $ref: '#/definitions/settings.CheckoutSettings'
      responses:
        '200':
          description: Updated checkout settings object
          schema:
            $ref: '#/definitions/settings.CheckoutSettings'
        default:
          description: Unexpected error
          schema:
            $ref: '#/definitions/common.CommonError'

  /getSkillsOnCourseSettings:
    get:
      x-filter:  
      - AuthFilter
      operationId: getSkillsOnCourseSettings
      summary: Get SkillsOnCourse settings
      description: Get SkillsOnCourse settings
      tags:
        - Settings
      responses:
        '200':
          description: response with SkillsOnCourse settings object
          schema:
            $ref: '#/definitions/settings.SkillsOnCourseSettings'
        default:
          description: Unexpected error
          schema:
            $ref: '#/definitions/common.CommonError'

  /setSkillsOnCourseSettings:
    post:
      x-filter:  
      - AuthFilter
      summary: Save SkillsOnCourse settings
      operationId: setSkillsOnCourseSettings
      description: Save SkillsOnCourse settings
      tags:
        - Settings
      consumes:
        - application/json
      parameters:
        - name: SkillsOnCourseSettingsRequest
          in: body
          description: SkillsOnCourse settings object
          required: true
          schema:
            $ref: '#/definitions/settings.SkillsOnCourseSettings'
      responses:
        '200':
          description: Updated SkillsOnCourse settings object
          schema:
            $ref: '#/definitions/settings.SkillsOnCourseSettings'
        default:
          description: Unexpected error
          schema:
            $ref: '#/definitions/common.CommonError'

  /getRedirectSettings:
    get:
      x-filter:  
      - AuthFilter
      operationId: getRedirectSettings
      summary: Get redirect settings
      description: Get redirect settings
      tags:
        - Settings
      responses:
        '200':
          description: response with redirect settings object
          schema:
            $ref: '#/definitions/settings.RedirectSettings'
        default:
          description: Unexpected error
          schema:
            $ref: '#/definitions/common.CommonError'

  /setRedirectSettings:
    post:
      x-filter:  
      - AuthFilter
      summary: Save redirect settings
      operationId: setRedirectSettings
      description: Save redirect settings
      tags:
        - Settings
      consumes:
        - application/json
      parameters:
        - name: RedirectSettingsRequest
          in: body
          description: redirect settings object
          required: true
          schema:
            $ref: '#/definitions/settings.RedirectSettings'
      responses:
        '200':
          description: Updated redirect settings object
          schema:
            $ref: '#/definitions/settings.RedirectSettings'
        default:
          description: Unexpected error
          schema:
            $ref: '#/definitions/common.CommonError'

  /getWebsiteSettings:
    get:
      x-filter:  
      - AuthFilter
      operationId: getWebsiteSettings
      summary: Get Website settings
      description: Get Website settings
      tags:
        - Settings
      responses:
        '200':
          description: response with Website settings object
          schema:
            $ref: '#/definitions/settings.WebsiteSettings'
        default:
          description: Unexpected error
          schema:
            $ref: '#/definitions/common.CommonError'

  /setWebsiteSettings:
    post:
      x-filter:  
      - AuthFilter
      summary: Save website settings
      operationId: setWebsiteSettings
      description: Save website settings
      tags:
        - Settings
      consumes:
        - application/json
      parameters:
        - name: WebsiteSettingsRequest
          in: body
          description: website settings object
          required: true
          schema:
            $ref: '#/definitions/settings.WebsiteSettings'
      responses:
        '200':
          description: Updated website settings object
          schema:
            $ref: '#/definitions/settings.WebsiteSettings'
        default:
          description: Unexpected error
          schema:
            $ref: '#/definitions/common.CommonError'


parameters:
  XOrigin:
    name: X-Origin
    in: header
    description: Site URL which we send with every request.
    example: acme.oncourse.cc
    required: true
    type: string
  Session:
    name: X-Session-Token
    in: header
    description: User's session token
    required: true
    type: string



definitions:

  api.LoginRequest:
    type: object
    properties:
      email:
        type: string
        format: email
        description: user email
        example: john.smith@gmail.com
      password:
        type: string
        format: password
        description: User password
        example: htrgjat4Gh

  PageUrl:
    type: object
    properties:
      link:
        type: string
        description: unique link
        example: /contact
      isDefault:
        type: boolean
        description: this is the default URL for the page. Setting this unsets all other pageUrl defaults

  Block:
    type: object
    properties:
      id:
        type: integer
      title:
        type: string
        description: Unique name of block
        example: sidebar
      content:
        type: string
        description: Rich text content
        example: |
          h3. Subjects
          {tags}

  Version:
    type: object
    properties:
      id:
        type: integer
        description: unique id of version
      published:
        type: boolean
        description: has version published
      author:
        type: string
        description: First and last name of the user who published version
        example: Jane Smith
      changes:
        type: integer
        minimum: 0
        description: count of changes from previous version
        example: 12
      date:
        type: string
        format: date
        description: date when version was published

  Layout:
    type: object
    properties:
      id:
        type: integer
        description: unique id of the layout
      layoutKey:
        type: string
        description: Unique name of the layout
        example: layout-B

  Page:
    type: object
    properties:
      number:
        type: integer
        description: page number
      title:
        type: string
        description: title of the page
        example: Contact us
      themeId:
        type: integer
        description: theme id used for the page
      content:
        type: string
        description: Rich text content
        example: |
          Phone us on (02) 9550 5001 to find out more.
      visible:
        type: boolean
        description: Is the page visible
      reservedURL:
        type: boolean
        description: Indicates that page is a special system page and content is not editable
      urls:
        type: array
        items:
          $ref: '#/definitions/PageUrl'

  BlockItem:
    type: object
    properties:
      id:
        type: integer
        description: unique id of the Block
      position:
        type: integer
        description: order position of the block
        example: 2

  ThemeSchema:
    type: object
    properties:
      top:
        type: array
        items:
          $ref: '#/definitions/BlockItem'
      left:
        type: array
        items:
          $ref: '#/definitions/BlockItem'
      centre:
        type: array
        items:
          $ref: '#/definitions/BlockItem'
      right:
        type: array
        items:
          $ref: '#/definitions/BlockItem'
      footer:
        type: array
        items:
          $ref: '#/definitions/BlockItem'

  Theme:
    type: object
    properties:
      id:
        type: integer
        description: Unique identifier of theme
      title:
        type: string
        description: title of theme
        example: default
      layoutId:
        type: integer
        description: Layout id which is used for this theme
      schema:
        $ref: '#/definitions/ThemeSchema'

  MenuItem:
    type: object
    properties:
      id:
        type: integer
        description: Unique identifier of menu item
      title:
        type: string
        description: title of menu item
        example: about us
      url:
        type: string
        format: uri
        description: url for menu link
        example: /about
      expanded:
        type: boolean
      children:
        type: array
        items:
          $ref: '#/definitions/MenuItem'
      errors:
        type: object
        properties:
          title:
            type: string
          url:
            type: boolean

  User:
    type: object
    properties:
      firstName:
        type: string
        description: First name of the user
        example: John
      lastName:
        description: Last name of the user
        type: string
        example: Smith

  common.CommonError:
    type: object
    properties:
      code:
        type: integer
      message:
        type: string

  common.ValidationError:
    type: object
    required:
      - formErrors
      - fieldsErrors
    properties:
      formErrors:
        type: array
        items:
          type: string
        description: Global error
      fieldsErrors:
        type: array
        items:
          title: common.FieldError
          type: object
          required:
            - name
            - error
          properties:
            name:
              type: string
              description: Name of fiels with error
            error:
              type: string
              description: 'Errors for particular field, or empty array'
        description: 'Array of fields errors, or empty array'
  settings.RedirectItem:
    type: object
    properties:
      from:
        type: string
        description: Redirect from url
      to:
        type: string
        description: Redirect to url
  settings.RedirectSettings:
    type: object
    properties:
      rules:
        type: array
        items:
          $ref: '#/definitions/settings.RedirectItem'
  settings.SkillsOnCourseSettings:
    type: object
    properties:
      hideStudentDetails:
        type: boolean
      enableOutcomeMarking:
        type: boolean
      tutorFeedbackEmail:
        type: string
  settings.ClassCondition:
    type: string
    enum:
      - afterClassStarts
      - beforeClassStarts
      - afterClassEnds
      - beforeClassEnds
  settings.ClassEnrolmentCondition:
    type: string
    enum:
      - afterClassStarts
      - beforeClassStarts
      - beforeClassEnds
  settings.ClassAge:
    type: object
    properties:
      hideClassDays:
        type: integer
      hideClassCondition:
        $ref: '#/definitions/settings.ClassCondition'
      stopWebEnrolmentDays:
        type: integer
      stopWebEnrolmentCondition:
        $ref: '#/definitions/settings.ClassEnrolmentCondition'
  settings.WebsiteSettings:
    type: object
    properties:
      enableSocialMedia:
        type: boolean
      addThisId:
        type: string
      enableForCourse:
        type: boolean
      enableForWebpage:
        type: boolean
      classAge:
        $ref: '#/definitions/settings.ClassAge'
  settings.CheckoutSettings:
    type: object
    properties:
      successUrl:
        type: string
        format: uri
      refundPolicy:
        type: string
        format: uri
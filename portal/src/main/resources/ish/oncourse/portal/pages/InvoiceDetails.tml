<html t:type="pagestructure" title="literal:Invoice"
      xmlns:t="http://tapestry.apache.org/schema/tapestry_5_1_0.xsd" activeMenu="literal:history">

<div class="page-header clearfix">
    <h3><a href="#">Tax invoice</a></h3>
</div>
<table width="100%" class="address-table">
    <tbody>
    <tr>
        <td width="50%"></td>
        <td width="50%" class="text-right" valign="top">
            ${invoice.college.name}<br/>
            ${controller.avetmissAddress1}  ${controller.avetmissAddress2}<br/>
            ${controller.avetmissSuburb} ${controller.avetmissStateName} ${controller.avetmissPostcode}<br/>
            <t:if test="${controller.collegeABN}">
                ABN: ${controller.collegeABN}<br/>
            </t:if>
        </td>
    </tr>
    <tr>
        <td colspan="2">&nbsp;</td>
    </tr>
    <tr>
        <td colspan="2">&nbsp;</td>
    </tr>
    </tbody>
</table>
<br/>
<table width="100%" class="address-table">
    <tbody>
    <tr>
        <td width="50%">${invoice.contact.fullName}<br/>
            ${invoice.billToAddress}<br/>
        </td>
        <td width="50%" class="text-right" valign="top">
            ${date} <br/>
            Invoice ${invoice.invoiceNumber} <br/>

        </td>
    </tr>
    </tbody>
</table>
<br/>
<table class="table">
    <thead>
    <tr>
        <th width="40%">Title</th>
        <th class="text-right">Price each</th>
        <th class="text-right">Discount</th>
        <th class="text-right">Tax</th>
        <th class="text-right">Total</th>
    </tr>
    </thead>
    <tbody>
    <t:loop source="invoiceLines" value="invoiceLine">
        <tr>
            <td>${invoiceLine.title}</td>
            <td class="text-right">
                <t:output value="invoiceLine.priceTotalExTax" format="moneyFormat(invoiceLine.priceTotalExTax)"/>
            </td>
            <td class="text-right">
                <t:output value="invoiceLine.discountTotalExTax" format="moneyFormat(invoiceLine.discountTotalExTax)"/>
            </td>
            <td class="text-right">
                <t:output value="invoiceLine.totalTax" format="moneyFormat(invoiceLine.totalTax)"/>
            </td>
            <td class="text-right">
                <t:output value="invoiceLine.finalPriceToPayIncTax"
                          format="moneyFormat(invoiceLine.finalPriceToPayIncTax)"/>
            </td>
        </tr>
    </t:loop>
    </tbody>
    <thead>
    <tr>
        <th colspan="3" width="40%">Total</th>
        <th class="text-right">
            <t:output value="totalTax" format="moneyFormat(totalTax)"/>
        </th>
        <th class="text-right">
            <t:output value="invoice.totalGst" format="moneyFormat(invoice.totalGst)"/>
        </th>
    </tr>
    </thead>

    <tbody>
    <tr>
        <td colspan="2"></td>
        <td colspan="2">Less amount paid</td>
        <td class="text-right">
            <t:output value="paidAmount" format="moneyFormat(paidAmount)"/>
        </td>
    </tr>
    <tr>
        <td colspan="2"></td>
        <td colspan="2">Total owing</td>
        <td class="text-right">
            <t:output value="invoice.amountOwing" format="moneyFormat(invoice.amountOwing)"/>
        </td>
    </tr>
        <t:if test="invoice.invoiceDueDates.isEmpty()">
            <tr>
                <td class="zero-padding" colspan="5"></td>
            </tr>
        </t:if>
    </tbody>
    <t:if test="invoice.invoiceDueDates.isEmpty()" negate="true">
        <thead class="payment-plan">
        <tr class="not-top-border">
            <th colspan="5"></th>
        </tr>
        <tr class="not-top-border">
            <th colspan="2"></th>
            <th colspan="2">Payment Plan</th>
            <th class="text-right" colspan="2">Amount Payable</th>
        </tr>
        </thead>
        <tbody class="payment-plan">
            <t:loop source="invoiceDueDates" value="invoiceDueDate">
                <t:if test="isUnpaidAmountNonZero(invoiceDueDate)">
                    <tr>
                        <td colspan="2"></td>
                        <td colspan="2"><t:output value="invoiceDueDate.dueDate" format="dateFormat()"/></td>
                        <td class="text-right"><t:output value="getUnpaidAmount(invoiceDueDate)" format="moneyFormat(invoiceDueDate.amount)"/></td>
                    </tr>
                    </t:if>
            </t:loop>
        </tbody>
    </t:if>
</table>

</html>
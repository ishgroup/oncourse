<?xml version="1.0" encoding="UTF-8" ?>
<dataConfig>
    <dataSource name="onCourseDS" driver="com.mysql.jdbc.Driver"
                url="jdbc:mysql://localhost:3306/willow_college" user="root" password="test"
                readOnly="true" autoCommit="false"/>
    <document>
        <entity name="course" dataSource="onCourseDS"
                query="select id, name, detail, code, collegeId from course" pk="id">
			<field name="id" column="id"/>
			<field name="name" column="name"  />
			<field name="detail" column="detail"  />
            <field name="course_code" column="code"  />
            <field name="collegeId" column="collegeId" />
            <entity name="courseClass" query="select cc.id, cc.code from courseclass cc where courseid='${course.id}'" dataSource="onCourseDS" pk="cc.id">
                <field name="id" column="cc.id"/>
                <field name="class_code" column="cc.code"/>
                <entity name="site" query="select s.suburb, s.latitude, s.longitude, s.postcode from site s inner join room r 
                	on r.siteId=s.id inner join courseclass cc on cc.roomId=r.id where cc.id='${courseClass.id}'
                	union select s.suburb, s.latitude, s.longitude, s.postcode from site s inner join room r on r.siteId=s.id 
                	inner join session ss on ss.roomId=r.id inner join courseclass cc on cc.id=ss.courseClassId where cc.id='${courseClass.id}'">
                	<field name="location" template="${s.latitude},${s.longitude}"/>
                	<field name="postcode" column="s.postcode"/>
                	<field name="suburb" column="s.suburb"/>
                </entity>
                <entity name="tutor" query="select c.givenName, c.familyName from contact c inner join tutor t on c.tutorId = t.id
                    inner join tutorrole tr on t.id = tr.tutorId
                    inner join courseclass cc on tr.courseClassId=cc.id where cc.id='${courseClass.id}'" dataSource="onCourseDS">
                    <field name="full_name" template="${t.givenName} ${t.familyName}"/>
                </entity>
                <entity name="session" query="select s.startDate, s.endDate from session s inner join courseclass cc on s.courseClassId=cc.id where cc.id='${courseClass.id}'">
                	<field name="startDate" column="s.startDate"/>
                	<field name="endDate" column="s.endDate"/>
                </entity>
            </entity>
        </entity>
    </document>
</dataConfig>
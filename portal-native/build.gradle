apply plugin: 'com.github.node-gradle.node'

node {
    version = '14.16.0'
    yarnVersion = '1.22.10'
    download = System.properties['os.name'] != "FreeBSD" // FreeBSD has no binaries this plugin can install
}

yarn_install.args = ['--verbose']

task webpack(type: YarnTask, dependsOn: 'yarn_install') {
    args = ['expo', 'build:web']
}

task jest(type: YarnTask, dependsOn: 'yarn_install') {
    args = ['test']
}

test.dependsOn(jest)

build.dependsOn(webpack)

processResources.dependsOn(":portal-api:swagger")

publishing {
    publications {
        executables(MavenPublication) {
            artifact(file("${buildDir}/distribution/${project.name}.zip")) {
                classifier "executable"
                extension "zip"
                builtBy build
            }
        }
    }
}
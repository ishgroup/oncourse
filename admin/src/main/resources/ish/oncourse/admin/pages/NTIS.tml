<html t:type="pagestructure" title="literal:NTIS"
	xmlns:t="http://tapestry.apache.org/schema/tapestry_5_1_0.xsd" xmlns:p="tapestry:parameter">
	
	<h4>Reference data last updated on ${lastUpdateDate}</h4>
	
	<t:if test="updateInProgress" negate="true">
		<t:form t:id="updateForm">
			<table>
				<tr>
					<td>From:</td>
					<td><t:textfield t:id="dateFrom" size="10"/></td>
					<td>To:</td>
					<td><t:textfield t:id="dateTo" size = "10"/></td>
				</tr>
				<tr>
					<td><t:submit t:id="update" value="Update" /></td>
				</tr>
			</table>
		</t:form>
	</t:if>
	
	<div id="results"></div>

	<script type="text/javascript">
		jQuery(function() {		
			jQuery( "#dateFrom" ).datepicker({ dateFormat: 'yy/mm/dd' });
			jQuery( "#dateTo" ).datepicker({ dateFormat: 'yy/mm/dd' });
			var statusUpdate = function() {
				jQuery.getJSON('${ntisResultUrl}', function(data) {
			  		var items = [];
			  		jQuery.each(data, function(key, val) {
			    		items.push('<li>' + val + '</li>');
			    		jQuery('#results').empty();
				  		jQuery('<ul/>', {'class': 'my-new-list', html: items.join('')}).appendTo('#results');
				  	});
			  	});
			};
			setTimeout(statusUpdate, 1);
			setInterval(statusUpdate, 5000);
		});
	</script>	
</html>	
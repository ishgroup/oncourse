<html t:type="pagestructure" title="literal:College Overview"
	xmlns:t="http://tapestry.apache.org/schema/tapestry_5_1_0.xsd" xmlns:p="tapestry:parameter">
	
	<span t:type="editTabs" college="college" selected="literal:overview"/>
	
	<h1>${college.name}</h1>
	
	<table class="table table-striped table-condensed">
		<tr>
			<td>Last IP:</td>
			<td>${lastIP}</td>
		</tr>
		<tr>
			<td>onCourse version:</td>
			<td>${onCourseVersion}</td>
		</tr>
		<tr>
			<td>Replication state:</td>
			<td>${replicationState}</td>
		</tr>
		<tr>
			<td>Last replication:</td>
			<td>${lastReplication}</td>
		</tr>
		<tr>
			<td>S3 bucket name:</td>
			<td>
				<t:if test="bucketName">
					${bucketName}
					<p:else>
						<a href="#enableStorageModal" role="button" class="btn btn-btn-primary" data-toggle="modal" data-target="#enableStorageModal">Enable S3</a>	
					</p:else>
				</t:if>
			</td>
		</tr>
		<tr>
			<td>AUSKey status:</td>
			<td>
				<t:if test="ausKeySet">
					AUSKey has been set up
					<p:else>
						No AUSKey has been provided yet
					</p:else>
				</t:if>
			</td>
		</tr>
		<tr>
			<td>Upload AUSKey</td>
			<td>
				<t:form t:id="ausKeyForm">
					<t:errors/>
					<label for="file">Keystore file:</label><input t:type="upload" id="file" t:id="file" t:value="auskeyFile" validate="required"/><label for="password">Password:</label>
					<input t:type="passwordfield" id="password" t:id="password" t:value="auskeyPassword" validate="required"/>
					<t:if test="ausKeySet">
						<p><input t:type="submit" t:id="reUpload" class="btn btn-danger" value="Override AUSKey"/></p>
						<p:else>
							<p><input t:type="submit" t:id="upload" class="btn btn-success" value="Upload"/></p>
						</p:else>
					</t:if>
				</t:form>
			</td>
		</tr>
	</table>

	<a href="#disableModal" role="button" class="btn btn-danger" data-toggle="modal" data-target="#disableModal">Disable College</a>
	
	<div id="disableModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="disableLabel" aria-hidden="true">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
			<h3 id="disableLabel">Disable College</h3>
		</div>
		<div class="modal-body">
			<p>This is pretty catastrophic... Are you sure you want to proceed?</p>
		</div>
		<div class="modal-footer">
			<button class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button>
			<t:actionlink t:id="disableCollege" class="btn btn-primary btn-danger">Disable College</t:actionlink>
		</div>
	</div>

	<div id="enableStorageModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="enableStorageLabel" aria-hidden="true">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
			<h3 id="enableStorageLabel">Enable S3</h3>
		</div>
		<div class="modal-body">
			<p>Please enter bucket and user name to proceed. This will create a new S3 bucket and access key for the college.</p>
			<label for="bucketName">Bucket name:</label>
			<input id="bucketName" type="text"/>
			<label for="userName">AWS user name:</label>
			<input id="userName" type="text"/>
		</div>
		<div id="errors" style="background-color: #f2dede">
		</div>
		<div class="modal-footer">
			<button class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button>
			<t:eventlink t:id="enableExternalStorageEvent" id="enableExternalStorage" style="{display: none;}" class="enableExternalStorage"/>
			<button id="enableS3Button" class="btn btn-primary btn-success">Enable S3</button>
		</div>
	</div>

	<script type="text/javascript">
		jQuery(function() {
			jQuery("#enableS3Button").click(function() {

				var bucketName = jQuery("#bucketName").attr("value");
				var userName = jQuery("#userName").attr("value");
				
				var url = jQuery("#enableExternalStorage").attr("href");

				jQuery.ajax({
					type: "POST",
					url: url,
					async: false,
					data: {
						bucket_name: bucketName,
						user_name: userName
					},
					success: function(data) {
						if (data["result"] == "success") {
							location.reload();
						} else {
							var errorBlock = jQuery("#errors")
							errorBlock.empty();
							errorBlock.append(data["error"]);
						}
					},
					dataType: "json"
				});
			});
		});
	</script>

</html>
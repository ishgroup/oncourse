<html t:type="pagestructure" title="literal:College Web"
	  xmlns:t="http://tapestry.apache.org/schema/tapestry_5_1_0.xsd">
	
	<span t:type="editTabs" college="college" selected="literal:web"/>
	
	<h1>${college.name}</h1>
	
	<h3>Domains</h3>
		<table class="table table-striped table-condensed">
			<thead>
				<tr>
					<th>Name</th>
					<th>Site</th>
				</tr>
			</thead>
			<tbody>
				<t:form t:id="domainsForm">
					<t:loop source="domains" value="currentDomain">
						<tr id="${currentDomain.name}">
							<td>${currentDomain.name}</td>
							<td>
								<div class="input-append">
									<t:select t:id="siteSelect" class="siteSelect" model="siteSelectModel" blankOption="never" context="currentDomain.name" value="selectedSite"/>
									<t:actionlink t:id="deleteDomain" class="btn" context="currentDomain.id"><i class="icon-trash"></i></t:actionlink>
								</div>
							</td>
						</tr>
					</t:loop>
				</t:form>
				<t:form t:id="newDomainForm">
					<tr>
						<td><t:textfield t:id="newDomain" t:validate="required" value="newDomainValue"/></td>
						<td>
							<div class="input-append">
								<t:select t:id="newDomainSiteSelect" model="siteSelectModel" blankOption="never" value="newDomainSite"/>
								<t:submit t:id="addNewDomain" class="btn btn-success" value="Add"/>
							</div>
						</td>
					</tr>
				</t:form>
			</tbody>
		</table>
		
	
	<h3>Sites</h3>
		<t:if test="siteDeleteFailed">
			<span>Failed to delete site. Please delete all site data from CMS first, then try again.</span>
		</t:if>

	<t:if test="!validateHandler.getErrors().isEmpty()">
		<div class="validation">
			<ul>
				<t:loop source="validateHandler.errors.values()" value="error">
					<li><t:outputraw value="${error}"/></li>
				</t:loop>
			</ul>
		</div>
	</t:if>

	<table class="table table-striped table-condensed">
			<thead>
				<tr>
					<th>Site Name</th>
					<th>Site Key</th>
					<th>Google Analytics</th>
					<th>Google TagManager</th>
                    <th>Courses root tag name</th>
				</tr>
			</thead>
			<tbody>
				<t:form t:id="sitesEditForm">
					<t:loop source="sites.keySet()" value="currentSiteKey">
						<tr>
							<td>${currentWebSite.name}</td>
							<td>${currentWebSite.siteKey}</td>
							<td>
								<div class="input-append">
									<t:textfield t:id="googleAnalyticsAccount" value="currentWebSite.googleAnalyticsAccount"/>
								</div>
							</td>
							<td>
								<div class="input-append">
									<t:textfield t:id="googleTagmanagerAccount" value="currentWebSite.googleTagmanagerAccount"/>
								</div>
							</td>
                            <td>
                                <div class="input-append">
                                    <t:textfield t:id="coursesRootTagName" value="currentWebSite.coursesRootTagName"/>
                                    <t:actionlink t:id="deleteSite" class="btn" context="currentWebSite.siteKey"><i class="icon-trash"></i></t:actionlink>
                                </div>
                            </td>
						</tr>
					</t:loop>
					<tr>
						<td colspan="5"><t:submit t:id="saveSites" class="btn btn-primary" value="Save"/></td>
					</tr>
				</t:form>
				<t:form t:id="sitesForm">
				<tr>
					<td><t:textfield t:id="newSiteName" t:validate="required" value="newSiteNameValue"/></td>
					<td><t:textfield t:id="newSiteKey" t:validate="required" value="newSiteKeyValue"/></td>
					<td>
						<div class="input-append">
							<t:textfield t:id="newSiteGoogeAnalytics" value="newSiteGoogleAnalyticsValue"/>
						</div>
					</td>
					<td>
						<div class="input-append">
							<t:textfield t:id="newSiteGoogleTagmanager" value="newSiteGoogleTagmanagerValue"/>
						</div>
					</td>
                    <td>
                        <div class="input-append">
                            <t:textfield t:id="newSiteCoursesRootTagName" value="newSiteCoursesRootTagName"/>
                            <t:submit t:id="addNewSite" class="btn btn-success" value="Add"/>
                        </div>
                    </td>
					<td></td>
				</tr>
				</t:form>
			</tbody>
		</table>
	
	<h3>CMS Users</h3>
		<table class="table table-striped table-condensed">
			<thead>
				<tr>
					<th>email</th>
					<th>Password</th>
					<th>First Name</th>
					<th>Last Name</th>
				</tr>
			</thead>
			<tbody>
				<t:loop source="cmsUsers" value="currentUser">
					<tr>
						<td>${currentUser.email}</td>
						<td>********</td>
						<td>${currentUser.firstName}</td>
						<td>${currentUser.lastName}</td>
						<td><t:actionlink t:id="deleteUser" class="btn" context="currentUser.email"><i class="icon-trash"></i></t:actionlink></td>
					</tr>
				</t:loop>
				<t:form t:id="cmsUsersForm">
				<tr>
					<td><t:textfield t:id="newUserEmail" t:validate="required" value="newUserEmailValue"/></td>
					<td><t:passwordfield t:id="newUserPassword" t:validate="required" value="newUserPasswordValue"/></td>
					<td><t:textfield t:id="newUserFirstName" t:validate="required" value="newUserFirstNameValue"/></td>
					<td><t:textfield t:id="newUserLastName" t:validate="required" value="newUserLastNameValue"/></td>
					<td><t:submit t:id="addNewUser" class="btn btn-success" value="Add"/></td>
				</tr>
				</t:form>
			</tbody>
		</table>

	<script type="text/javascript">
		jQuery(function() {
			jQuery(".siteSelect").change(function() {
				var domain = jQuery(this).closest("tr").attr("id");
				var site = jQuery(this).attr("value");
				jQuery.ajax({
					type: "GET",
					url: "${changeSiteUrl}",
					data: "domain=" + domain + "\u0026site=" + site
				});
			});
		});
	</script>
</html>
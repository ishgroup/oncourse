<html t:type="pagestructure" title="literal:College Web"
	xmlns:t="http://tapestry.apache.org/schema/tapestry_5_1_0.xsd" xmlns:p="tapestry:parameter">
	
	<span t:type="editTabs" college="college" selected="literal:web"/>
	
	<h1>${college.name}</h1>
	
	<h3>Domains</h3>
		<table>
			<thead>
				<tr>
					<td>Name</td>
					<td>Site</td>
				</tr>
			</thead>
			<tbody>
				<t:form t:id="domainsForm">
					<t:loop source="domains" value="currentDomain">
						<tr id="${currentDomain.name}">
							<td>${currentDomain.name}</td>
							<td><t:select t:id="siteSelect" class="siteSelect" model="siteSelectModel" blankOption="never" context="currentDomain.name" value="selectedSite"/></td>
							<td><t:actionlink t:id="deleteDomain" context="currentDomain.getName()">[x]</t:actionlink></td>
						</tr>
					</t:loop>
				</t:form>
				<t:form t:id="newDomainForm">
					<tr>
						<td><t:textfield t:id="newDomain" t:validate="required" value="newDomainValue"/></td>
						<td><t:select t:id="newDomainSiteSelect" model="siteSelectModel" blankOption="never" value="newDomainSite"/></td>
						<td><t:submit t:id="addNewDomain" class="btn btn-primary" value="Add"/></td>
					</tr>
				</t:form>
			</tbody>
		</table>
		
	
	<h3>Sites</h3>
		<t:if test="siteDeleteFailed">
			<span>Failed to delete site. Please delete all site data from CMS first, then try again.</span>
		</t:if>
		<table>
			<thead>
				<tr>
					<td>Site Name</td>
					<td>Site Key</td>
					<td>Google Analytics</td>
				</tr>
			</thead>
			<tbody>
				<t:form t:id="sitesEditForm">
					<t:loop source="sites.keySet()" value="currentSiteKey">
						<tr>
							<td>${currentWebSite.name}</td>
							<td>${currentWebSite.siteKey}</td>
							<td><t:textfield t:id="currentWebSiteKey" value="currentWebSite.googleAnalyticsAccount"/></td>
							<td><t:actionlink t:id="deleteSite" context="currentWebSite.siteKey">[x]</t:actionlink></td>
						</tr>
					</t:loop>
					<tr>
						<td></td><td></td><td></td>
						<td><t:submit t:id="saveSites" class="btn btn-primary" value="Save"/></td>
					</tr>
				</t:form>
				<t:form t:id="sitesForm">
				<tr>
					<td><t:textfield t:id="newSiteName" t:validate="required" value="newSiteNameValue"/></td>
					<td><t:textfield t:id="newSiteKey" t:validate="required" value="newSiteKeyValue"/></td>
					<td><t:textfield t:id="newSiteGoogeAnalytics" value="newSiteGoogleAnalyticsValue"/></td>
					<td><t:submit t:id="addNewSite" class="btn btn-primary" value="Add"/></td>
				</tr>
				</t:form>
			</tbody>
		</table>
	
	<h3>CMS Users</h3>
		<table>
			<thead>
				<tr>
					<td>email</td>
					<td>Password</td>
					<td>First Name</td>
					<td>Last Name</td>
				</tr>
			</thead>
			<tbody>
				<t:loop source="cmsUsers" value="currentUser">
					<tr>
						<td>${currentUser.email}</td>
						<td>********</td>
						<td>${currentUser.firstName}</td>
						<td>${currentUser.lastName}</td>
						<td><t:actionlink t:id="deleteUser" context="currentUser.email">[x]</t:actionlink></td>
					</tr>
				</t:loop>
				<t:form t:id="cmsUsersForm">
				<tr>
					<td><t:textfield t:id="newUserEmail" t:validate="required" value="newUserEmailValue"/></td>
					<td><t:passwordfield t:id="newUserPassword" t:validate="required" value="newUserPasswordValue"/></td>
					<td><t:textfield t:id="newUserFirstName" t:validate="required" value="newUserFirstNameValue"/></td>
					<td><t:textfield t:id="newUserLastName" t:validate="required" value="newUserLastNameValue"/></td>
					<td><t:submit t:id="addNewUser" class="btn btn-primary" value="Add"/></td>
				</tr>
				</t:form>
			</tbody>
		</table>

	<script type="text/javascript">
		jQuery(function() {
			jQuery(".siteSelect").change(function() {
				var domain = jQuery(this).closest("tr").attr("id");
				var site = jQuery(this).attr("value");
				jQuery.ajax({
					type: "GET",
					url: "${changeSiteUrl}",
					data: "domain=" + domain + "\u0026site=" + site
				});
			});
		});
	</script>
</html>
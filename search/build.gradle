apply plugin: 'war'

dependencies {
    providedCompile 'javax.servlet:servlet-api:3.0'
	
	compile project(':common:common-services')
	//compile 'commons-lang:commons-lang:2.6'

	compile ('org.apache.solr:solr-dataimporthandler:5.3.0') {
		exclude group: 'org.apache.hadoop'
		exclude group: 'org.eclipse.jetty'
	}
	compile 'com.vividsolutions:jts:1.13'

	// The odd next line is to work around gradle pulling in the wrong configuration
	// http://forums.gradle.org/gradle/topics/transitive_libraries_not_included_through_project_dependency
	testCompile project(path: ':common:common-test', configuration: 'testFixtures')
	
	testCompile ('org.apache.solr:solr-test-framework:5.3.0') {
		exclude group: 'org.apache.hadoop'
		exclude group: 'org.eclipse.jetty'
	}
	testCompile 'org.apache.lucene:lucene-test-framework:5.3.0'
	testCompile 'mysql:mysql-connector-java:5.1.35'
	testCompile 'com.google.code.gson:gson:2.2.4'
	//testCompile project(':common:common-services')
}

test {
	if (project.hasProperty('searchTestDatabaseUri')) {
		systemProperty 'testDatabaseUri', searchTestDatabaseUri
		systemProperty 'testDatabaseDriver', searchTestDatabaseDriver
	}
}

war {
	archiveName = 'search.war'
	manifest {
		from sharedManifest
	}

	into('/') {
		from zipTree(project.configurations.compile.find { it.name.startsWith("solr-") })
		exclude 'WEB-INF/*'
	}
}
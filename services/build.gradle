apply from: "$rootDir/buildTapestryApp.gradle"

sourceSets {
    main {
        java {
            srcDirs 'src/main/java'
            srcDirs 'src/main/generated'
        }
    }
}
configurations {
    all*.exclude group: 'org.apache.derby', module: 'derby'
}


dependencies {
    testCompile project(':common:test-functions')
}

task generateSources(type: Copy) {
    from 'src/templates'
    into 'src/main/generated'
    expand(replicationVersions: replicationVersions, referenceVersions: referenceVersions)
}


test {
    systemProperty 'oncourse.jdbc.url', "${project.property('willowTest_uri')}/willowTest_services?autoReconnect=true" +
            "&zeroDateTimeBehavior=convertToNull" +
            "&useUnicode=true" +
            "&characterEncoding=utf8" +
            "&sessionVariables=default_storage_engine=MEMORY"
    systemProperty 'oncourse.jdbc.user', project.property("willowTest_user")
    systemProperty 'oncourse.jdbc.password', project.property("willowTest_pass")
    systemProperty 'shouldCreateTables', System.getProperty("shouldCreateTables")
}

mainClassName = 'ish.oncourse.webservices.ServicesApp'

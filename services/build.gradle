apply from: "$rootDir/gradle/functions.gradle"
apply from: "$rootDir/gradle/tapestry.app.gradle"
apply from: "$rootDir/gradle/cxf-spring.gradle"

sourceSets {
    main {
        groovy {
            srcDirs 'src/main/java'
            srcDirs 'src/main/groovy'
            srcDirs "${buildDir}/generated-resources/main/java"
        }
        java {
            srcDirs = []
        }
    }
}
configurations {
    all*.exclude group: 'org.apache.derby', module: 'derby'
}


dependencies {
    implementation project(':common:common-bootique')
    implementation("ish.oncourse.willow:webservices-client:$webservicesVersion") {
        //we should exclude cayenne-server from waCommon because the cayenne-server is not compatable to willow code.
        exclude group: 'org.apache.cayenne', module: 'cayenne-server'
        exclude group: 'org.apache.geronimo.specs', module: 'geronimo-javamail_1.4_spec'
    }
}

task generateSOAPstubs(type: Copy) {
    from 'src/templates'
    into "${buildDir}/generated-resources/main/java"
    expand(replicationVersions: replicationVersions, referenceVersions: referenceVersions)
}

compileJava {
    dependsOn generateSOAPstubs
}

test {
    forkEvery = 1 //run every test in separate jvm
    initTestDBConfig(project, test)
}

mainClassName = 'ish.oncourse.webservices.ServicesApp'

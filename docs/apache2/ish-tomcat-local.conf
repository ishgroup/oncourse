<VirtualHost *:80>
    ServerName local
    ServerAlias *.local.oncourse.net.au
    DocumentRoot /var/onCourse
    CustomLog /var/log/www/onCoursetest1-access_log combined
    ErrorLog /var/log/www/onCoursetest1-access_log

    Alias /default-ioc /var/onCourse/s/default

    RewriteEngine on
    RewriteRule ^/robots.txt$ /default-ioc/robots.txt [L,PT]

    # Rewrite favicon for IE bug
    RewriteRule ^/favicon.ico  /s/img/favicon.ico      [L]

    # Don't touch cgi-bin requests
    RewriteRule ^/cgi-bin/.*                           -       [L,PT]

    RewriteMap lowercase int:tolower

# ****************************** web site resources ***************************

    # match resource URLs for a college, or default if no file in the college (use active build)
    # eg /s/css/site.css
    RewriteCond    %{HTTP_HOST} ^(.*)\.local\.oncourse\.net\.au [NC]
    RewriteCond    %{DOCUMENT_ROOT}/s/%1/$1 -f
    RewriteRule    ^/s/(.*)            /s/%1/$1 [L]

    # if no file at the college location, try in default
    RewriteRule    ^/s/(.*)            /s/default/$1 [L]

# ***************************** SUBSITE resources *****************************
#is this needed anymore? how is tomcat deployment going to handle this?

    # match non-versioned resource URLs for a SUBSITE (use active build)
    # eg /workskills/s/css/site.css

    RewriteCond    %{HTTP_HOST}%{REQUEST_URI}        ^([^\.]*)\.local\.oncourse\.net\.au/([^/]+)/s/.* [NC]
    RewriteCond    %{DOCUMENT_ROOT}/s/%1_%2/$1 -f
    RewriteRule    ^/[^/]+/s/(.*)           /s/default/%1_%2/s/$1 [L]

    # match non-versioned resource URLs for a SUBSITE but use parent site file if not found in subsite (use active build)
    # eg /workskills/s/css/site.css

    RewriteCond    %{HTTP_HOST}%{REQUEST_URI} ^([^\.]*)\.local.oncourse\.net\.au/([^/]+)/s/.* [NC]
    RewriteCond    %{DOCUMENT_ROOT}/s/%1/$1 -f
    RewriteRule    ^/[^/]+/s/(.*)           /s/%1/$1 [L]

    # if no file at the subsite or parent site location, try in default
    RewriteRule    ^/[^/]+/s/(.*)           /s/default/$1 [L]

# *********************************************************************************
	 RewriteRule ^/cms/(.*) balancer://clusterB/cms/$1 [P,L]
     RewriteCond %{HTTP_COOKIE} cms
     RewriteRule ^/(.*) balancer://clusterB/cms/$1 [P,L]
    
    ProxyPass /asset balancer://clusterD/asset
    ProxyPass /enrol balancer://clusterB/enrol/
    ProxyPass /cms   balancer://clusterB/cms/
    ProxyPass /portal balancer://clusterB/portal/
    ProxyPass /services balancer://clusterC/services/
    ProxyPass /search-internal balancer://clusterA/search/
    ProxyPass / balancer://clusterA/web/

    RewriteLog /var/log/www/rewrite.log
    RewriteLogLevel 5

	<Proxy balancer://clusterA>
	        BalancerMember ajp://localhost:8009 route=A1-1 min=10 smax=10 acquire=10000
	</Proxy>

	<Proxy balancer://clusterB>
	        BalancerMember ajp://localhost:8009 route=B1-1 min=10 smax=10 acquire=10000
	</Proxy>

	<Proxy balancer://clusterC>
	        BalancerMember ajp://localhost:8009 route=C1-1 min=10 smax=10 acquire=10000
	</Proxy>
	
	<Proxy balancer://clusterD>
                BalancerMember ajp://localhost:8009 route=D1-1 min=10 smax=10 acquire=10000
        </Proxy>

	<Directory "/var/onCourse">
	    Options Indexes FollowSymLinks
	    AllowOverride All
	    Order allow,deny
	    Allow from 127.0.0.1
	</Directory>
</VirtualHost>

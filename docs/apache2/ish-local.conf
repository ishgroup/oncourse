<VirtualHost *:80>
    ServerName local
    ServerAlias *.local.oncourse.net.au
    DocumentRoot /Users/anton/willow/code/resources/resources
    CustomLog /var/log/www/onCoursetest1-access_log combined
    ErrorLog /var/log/www/onCoursetest1-access_log

    ErrorLog /var/log/www/onCoursetest1-access_log

    Alias /defaults-ioc /var/onCourse/s/defaults

    RewriteEngine on
    RewriteRule ^/robots.txt$ /defaults-ioc/robots.txt [L,PT]

    # Rewrite favicon for IE bug
    RewriteRule ^/favicon.ico  /s/img/favicon.ico      [L]

    # Don't touch cgi-bin requests
    RewriteRule ^/cgi-bin/.*                           -       [L,PT]

    RewriteMap lowercase int:tolower

# ****************************** web site resources ***************************

    # match resource URLs for a college, or default if no file in the college (use active build)
    # eg /s/css/site.css
    RewriteCond    %{HTTP_HOST} ^(.*)\.local\.oncourse\.net\.au [NC]
    RewriteCond    %{DOCUMENT_ROOT}/s/%1/$1 -f
    RewriteRule    ^/s/(.*)            /s/%1/$1 [L]

    # if no file at the college location, try in defaults
    RewriteRule    ^/s/(.*)            /s/defaults/$1 [L]

# ***************************** SUBSITE resources *****************************
#is this needed anymore? how is tomcat deployment going to handle this?

    # match non-versioned resource URLs for a SUBSITE (use active build)
    # eg /workskills/s/css/site.css

    RewriteCond    %{HTTP_HOST}%{REQUEST_URI}        ^([^\.]*)\.local\.oncourse\.net\.au/([^/]+)/s/.* [NC]
    RewriteCond    %{DOCUMENT_ROOT}/s/%1_%2/$1 -f
    RewriteRule    ^/[^/]+/s/(.*)           /s/defaults/%1_%2/s/$1 [L]

    # match non-versioned resource URLs for a SUBSITE but use parent site file if not found in subsite (use active build)
    # eg /workskills/s/css/site.css

    RewriteCond    %{HTTP_HOST}%{REQUEST_URI} ^([^\.]*)\.local.oncourse\.net\.au/([^/]+)/s/.* [NC]
    RewriteCond    %{DOCUMENT_ROOT}/s/%1/$1 -f
    RewriteRule    ^/[^/]+/s/(.*)           /s/%1/$1 [L]

    # if no file at the subsite or parent site location, try in defaults
    RewriteRule    ^/[^/]+/s/(.*)           /s/defaults/$1 [L]

# *********************************************************************************

    # If the CMS cookie is set, then the requests are served out by the CMS application
    RewriteCond %{HTTP_COOKIE} cms
    RewriteRule ^/(.*) balancer://clusterB/cms/ [P,L]

    # This is how you first log into the CMS
    RewriteRule ^/cms/(.*) balancer://clusterB/cms/ [P,L]

    ProxyPass /enrol balancer://clusterB/enrol/
    ProxyPass /portal balancer://clusterB/portal/
    ProxyPass /services balancer://clusterC/services/
    ProxyPass /search-internal balancer://clusterA/search/
    ProxyPass / balancer://clusterA/web/

    RewriteLog /var/log/www/rewrite.log
    RewriteLogLevel 5

	<Proxy balancer://clusterA>
	#       ProxySet min=10 # Start with 10 connections
	#       ProxySet smax=10 # If there are every more than 10 connections allow them to time out until we are back to 10
	#       ProxySet acquire=10000 # Don't wait more than 10 seconds for a new connection
	        BalancerMember http://scc.local.oncourse.net.au:8080 route=A1-1 min=10 smax=10 acquire=10000
	        #BalancerMember ajp://203.29.62.233:10001 route=A1-2 min=10 smax=10 acquire=10000 status=+S
	</Proxy>

	<Proxy balancer://clusterB>
	#       ProxySet min=10  # Start with 10 connections
	#       ProxySet smax=10 # If there are every more than 10 connections allow them to time out until we are back to 10
	#       ProxySet acquire=10000 # Don't wait more than 10 seconds for a new connection
	        BalancerMember http://scc.local.oncourse.net.au:8080 route=B1-1 min=10 smax=10 acquire=10000
	#BalancerMember ajp://203.29.62.233:11001 route=B1-2 min=10 smax=10 acquire=10000 status=+S
	</Proxy>

	<Proxy balancer://clusterC>
	#       ProxySet min=10  # Start with 10 connections
	#       ProxySet smax=10 # If there are every more than 10 connections allow them to time out until we are back to 10
	#       ProxySet acquire=10000 # Don't wait more than 10 seconds for a new connection
	        BalancerMember http://scc.local.oncourse.net.au:8080 route=C1-1 min=10 smax=10 acquire=10000
	#       BalancerMember ajp://203.29.62.233:12002 route=C1-2 min=10 smax=10 acquire=10000 status=+S
	</Proxy>
	
	<Directory "/Users/anton/willow/code/resources/resources">
	    Options Indexes FollowSymLinks
	    AllowOverride All
	    Order allow,deny
	    Allow from 127.0.0.1
	</Directory>
</VirtualHost>